# GAS Gmailトリガー セットアップ手順

PomeraからGmailにメールを送ると、自動的にGitHub Actionsが起動してナレッジグラフを更新する仕組みです。

---

## 1. Google Apps Script プロジェクトを作成

1. [script.google.com](https://script.google.com) にアクセス
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を「PomeraToKnowledge Trigger」に変更

## 2. スクリプトを貼り付け

1. デフォルトの `コード.gs` の内容を全て削除
2. `scripts/gas_gmail_trigger.js` の内容を全てコピーして貼り付け
3. 保存

## 3. GitHub Token をスクリプトプロパティに設定

1. 左メニューの ⚙「プロジェクトの設定」をクリック
2. 「スクリプト プロパティ」セクションの「スクリプト プロパティを追加」をクリック
3. 以下を入力:
   - **プロパティ**: `GITHUB_TOKEN`
   - **値**: 作成したGitHub Personal Access Token
4. 「スクリプト プロパティを保存」をクリック

## 4. トリガーを設定

1. 左メニューの ⏰「トリガー」をクリック
2. 「トリガーを追加」をクリック
3. 以下のように設定:
   - **実行する関数**: `checkPomeraMail`
   - **イベントのソース**: 時間主導型
   - **時間ベースのトリガーのタイプ**: 分ベースのタイマー
   - **間隔**: 1分おき
4. 「保存」をクリック
5. Gmailへのアクセス許可を求められたら許可する

## 5. テスト実行

1. GASエディタで `testTrigger` 関数を選択
2. ▶ 実行ボタンをクリック
3. GitHub Actions のページで ワークフローが起動されたことを確認

---

## トラブルシューティング

| 症状 | 対処法 |
|------|--------|
| 「GITHUB_TOKEN が未設定です」 | スクリプトプロパティを再確認 |
| GitHub API エラー 403 | PATの権限にContents: Read and writeが含まれているか確認 |
| GitHub API エラー 404 | リポジトリ名が正しいか確認 |
| メールが検出されない | 件名に「POMERA」が含まれているか、未読かを確認 |
