<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ポメラ ナレッジグラフ (Enhanced)</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', 'Hiragino Sans', 'Meiryo', sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      overflow: hidden;
    }

    #app {
      display: flex;
      height: 100vh;
    }

    /* ── サイドバー（左） ── */
    #sidebar {
      width: 320px;
      background: #1e293b;
      border-right: 1px solid #334155;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      flex-shrink: 0;
      box-shadow: 4px 0 24px rgba(0, 0, 0, 0.2);
      z-index: 10;
    }

    /* ── サイドバー（右：Future Goals） ── */
    #right-sidebar {
      width: 280px;
      background: #1e293b;
      border-left: 1px solid #334155;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      flex-shrink: 0;
      box-shadow: -4px 0 24px rgba(0, 0, 0, 0.2);
      z-index: 10;
    }

    #sidebar-header,
    #right-sidebar-header {
      padding: 20px;
      border-bottom: 1px solid #334155;
      background: linear-gradient(135deg, #1e293b, #0f172a);
    }

    #right-sidebar-header h2 {
      font-size: 16px;
      font-weight: 700;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .goal-list {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }

    .goal-item {
      background: rgba(30, 41, 59, 0.5);
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      transition: all 0.2s;
    }

    .goal-item:hover {
      background: #334155;
      border-color: #475569;
    }

    .goal-type {
      font-size: 10px;
      text-transform: uppercase;
      font-weight: 700;
      color: #94a3b8;
      margin-bottom: 4px;
      display: inline-block;
      padding: 2px 6px;
      border-radius: 4px;
      background: #0f172a;
    }

    .goal-type.event {
      color: #f472b6;
    }

    .goal-type.goal {
      color: #34d399;
    }

    .goal-date {
      font-size: 11px;
      color: #cbd5e1;
      margin-bottom: 4px;
    }

    .goal-label {
      font-size: 13px;
      font-weight: 600;
      color: #e2e8f0;
      line-height: 1.4;
    }

    /* ── コントロール ── */
    #controls {
      padding: 20px;
      border-bottom: 1px solid #334155;
      overflow-y: auto;
    }

    .control-group {
      margin-bottom: 20px;
    }

    .control-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #64748b;
      font-weight: 700;
      margin-bottom: 10px;
    }

    select,
    input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      background: #0f172a;
      border: 1px solid #334155;
      border-radius: 8px;
      color: #e2e8f0;
      font-size: 13px;
      margin-bottom: 12px;
      transition: all 0.2s;
    }

    select:focus,
    input[type="text"]:focus {
      outline: none;
      border-color: #60a5fa;
      box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.2);
    }

    /* Mode Switcher */
    .mode-switch {
      display: flex;
      background: #0f172a;
      border-radius: 8px;
      padding: 4px;
      border: 1px solid #334155;
      margin-bottom: 12px;
    }

    .mode-btn {
      flex: 1;
      text-align: center;
      padding: 6px;
      font-size: 12px;
      border-radius: 6px;
      cursor: pointer;
      color: #94a3b8;
      transition: all 0.2s;
    }

    .mode-btn.active {
      background: #334155;
      color: #fff;
      font-weight: 600;
    }

    .toggle-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 13px;
      color: #cbd5e1;
      cursor: pointer;
      padding: 4px 0;
    }

    .toggle-row:hover {
      color: #fff;
    }

    .toggle-row input {
      accent-color: #f472b6;
    }

    /* ── 詳細パネル ── */
    #detail-panel {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    .detail-card {
      background: linear-gradient(180deg, #1e293b, #0f172a);
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .detail-card h3 {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
    }

    .sentiment-badge {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 12px;
      background: #334155;
      font-weight: 600;
    }

    .badge-pos {
      background: rgba(52, 211, 153, 0.2);
      color: #34d399;
    }

    .badge-neg {
      background: rgba(248, 113, 113, 0.2);
      color: #f87171;
    }

    .badge-neu {
      background: rgba(148, 163, 184, 0.2);
      color: #94a3b8;
    }

    .detail-card .detail-text {
      font-size: 14px;
      color: #cbd5e1;
      line-height: 1.7;
      margin-bottom: 16px;
    }

    .tags-container {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 16px;
    }

    .tag {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 4px;
      background: #334155;
      color: #94a3b8;
      border: 1px solid #475569;
    }

    .tag.distortion {
      background: rgba(244, 63, 94, 0.15);
      border-color: rgba(244, 63, 94, 0.4);
      color: #fb7185;
    }

    /* ── グラフコンテナ ── */
    #graph-container {
      flex: 1;
      position: relative;
      background: radial-gradient(circle at center, #1e293b 0%, #0f172a 70%);
    }

    svg {
      width: 100%;
      height: 100%;
    }

    /* ── ツールチップ ── */
    .tooltip {
      position: absolute;
      padding: 12px 16px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid #475569;
      border-radius: 8px;
      font-size: 12px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.15s;
      max-width: 320px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      z-index: 100;
    }

    /* ── 凡例 ── */
    .legend {
      position: absolute;
      bottom: 24px;
      right: 24px;
      background: rgba(30, 41, 59, 0.9);
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 16px 20px;
      font-size: 11px;
      backdrop-filter: blur(8px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .legend h5 {
      color: #94a3b8;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .legend-line {
      width: 20px;
      height: 2px;
    }
  </style>
</head>

<body>
  <div id="app">
    <div id="sidebar">
      <div id="sidebar-header">
        <h1>ポメラ ナレッジグラフ</h1>
        <div class="stats" id="stats"></div>
      </div>

      <div id="controls">
        <div class="control-group">
          <div class="control-title">Analysis Mode</div>
          <div class="mode-switch">
            <div class="mode-btn active" onclick="setMode('default')">標準</div>
            <div class="mode-btn" onclick="setMode('sentiment')">感情分析</div>
            <div class="mode-btn" onclick="setMode('community')">コミュニティ</div>
          </div>
        </div>

        <div class="control-group">
          <div class="control-title">Search & Filter</div>
          <input type="text" id="search-input" placeholder="ノードを検索...">
          <label class="toggle-row">
            <input type="checkbox" id="highlight-distortion" onchange="toggleDistortion()">
            ⚠️ 認知の歪み (CBT) を強調
          </label>
        </div>

        <div class="control-group">
          <div class="control-title">Edge Filters</div>
          <div class="edge-toggle" id="edge-toggles">
            <!-- JSで生成 -->
          </div>
        </div>

        <div id="info-box"
          style="margin-top:20px; padding:12px; background:#334155aa; border-radius:8px; font-size:12px; display:none;">
          <strong style="color:#f472b6">💡 Analysis Insight</strong><br>
          <button onclick="resetZoom()">Zoom Reset</button>
        </div>

      </div>

      <div id="journal-list-container" style="flex: 1; overflow-y: auto; border-bottom: 1px solid #334155;">
        <div class="control-title" style="padding: 15px 20px 5px;">📜 Journal & Reviews</div>
        <div id="journal-list" style="padding: 0 15px 15px;">
          <!-- JS Populated -->
        </div>
      </div>

      <div id="detail-panel" style="flex: 1; border-top: 1px solid #334155;">
        <div class="detail-empty">ノードをクリックして詳細を表示</div>
      </div>
    </div>

    <div id="graph-container">
      <div class="tooltip" id="tooltip"></div>
      <div class="legend" id="legend">
        <!-- JSで生成 -->
      </div>
    </div>

    <!-- 右サイドバー -->
    <div id="right-sidebar">
      <div id="right-sidebar-header">
        <h2>Future Goals & Events</h2>
      </div>
      <div class="goal-list" id="goal-list">
        <!-- JS Populated -->
      </div>
    </div>
  </div>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>

    // ── データ（LLM抽出シミュレーション） ──
           GRAPH_DATA        RT          onst GRAPH_DATA = {
      s": [
    {
        ": "person: self"            "label": "自分",
      "type": "self",
        "          ": "日記の作成者。2つの仕事を掛          児と家事・ダイエットを並行してい               "sentiment": 0.2,
      "community": 0, "first_seen": "2026-02-15T18:28:14.833713"            "last_seen"          6-02 - 15T21: 4.7        5"            "weight": 17,
      "tags":
      },
    {
      "id          ent:pomera_arriva              "label": "ポメラの到着",
      "type": "          ,
      "detail": 購入したスケルトンのポメラが届く予定。",
           sentiment": 0.9,
               us": "Sche                  "date": -15",
      ":               "Excitement"              "Shopping"
      ],
      "community": 1            "first_seen": "2026-02-15T18:28:14.833719             "last_see        "20        2-          28:14.833719",
        "weight": 1

      {
        "id": "c          :skeleton_pomera",
          "label": "スケルトンポメラ",
            "type": "concept"            "detail": "メルカリで          きた、希少なスケルトンモデルのポ                "sentiment": 1.0,
        "community": 1            "first_seen": "2026-02-15T18:28:14.833720             "last_see        "20        2-          28:14.833720",
          "weight"
      },
      {
        "id": t:lalaport_trip",           "label": "ららぽーとお出かけ",
        "type": "even              "detail": "家族3          両親との買い物。蒼馬の用品を購入した。",
           sentiment": 0.7,           "status": "Completed",
        "community": 2            "first_seen": "2026-02-15T18:28:14.833722             "last_see        "20        2-          28:14.833722",
          "w          : 1
      },
      {
        "id": "person:say                "label": "さやか",
              e": "person",
            etail": "筆者の妻と思われる人物。",
        "community": 2            "first_seen": "2026-02-15T18:28:14.833722             "last_see        "20        2-          28:14.833722",
          "          ": 1
      },
      "id": "person:s          
      "label": "蒼馬",
        "type": "perso              "detail": "筆          ップやリモコンのおもちゃを買ってもらった。",
      "community": 2            "first_seen": "2026-02-15T18:28:14.833724             "last_see        "20        2-          28:14.833724",
        "weight":
    },
    {
      "id"          son:sayaka_parents             "label": "さやかの両親",
        "typ          erson",
        "d          : "一緒にららぽーとで買い物をした親族。",
      "community": 2            "first_seen": "2026-02-15T18:28:14.833725             "last_see        "20        2-          28:14.833725",
        "weight             },
      {
        "          place:gatten_sush              "label": "がってん寿司",
                : "place",
          "          ": "鯛の塩炙りが絶品だった寿                "sentiment": 0.9,
        "community": 2            "first_seen": "2026-02-15T18:28:14.833726             "last_see        "20        2-          28:14.833726",
          ght": 1
      },
      "id": "goal:d                "label": "ダイエット",
      "type": "go               "detail": "現在取          が、寿司やチュロスを食べてしまった。",           "sentimen,
        "status": "Active",
          "tags":                       nitive Distortio          uld Statement"
      ],
      "community": 2            "first_seen": "2026-02-15T18:28:14.833727             "last_see        "20        2-          28:14.833727",
        "weight":
    },
    {
      "id": "pro          lm_analysis",
        l": "LLM自己分析フローの構築",
      "type": "proje               "detail": "日記をL          ませて自己分析を行う仕組みの検討              "status": "Active",
        "community": 3            "first_seen": "2026-02-15T18:28:14.833728             "last_see        "20        2-          28:14.833728",
          "wei          1
    },
    {
      "concept:json_ld", "label": "JSON-LD",
        "type": "concept"            "detail": "LLMとの          なくすための構造化データフォーマ                "sentiment": 0.6,
      "community": 3            "first_seen": "2026-02-15T18:28:14.833729             "last_see        "20        2-          28:14.833729",
        "weight": 1
      {
        "id": "insi          eeform_writing",
          abel": "自由形式へのこだわり",
        "type": "insight",
          ail": "思考を遮らない自由な記          用の構造化をどう両立            。",
        "          ent          ,
        "tags": "Conflict"
      ],
        "community": 3            "first_seen": "2026-02-15T18:28:14.833730             "last_see        "20        2-          28:14.833730",
          "weight": 1
        {
          "id": "insight          pomera_failure",
            abel": "過去のポメラ挫折経験",
          "type": "insight"            "detail": "DM100、          M200を使いこなせ            ",
            "senti           -0              "tags": [
          "Past Failure"
      ],
          "community": 1            "first_seen": "2026-02-15T18:28:14.833730             "last_see        "20        2-          28:14.833730",
            "weight"
        },
        {
          "id"          tion:writing_joy",
          "label": "日記を書く達成感",
            "type": "e          ",
              "detail": モヤが晴れ、自分と向            。",
                  nt": 1.0,
                : ["Growth",
            Mental Health"
          ],
            "community": 0            "first_seen": "2026-02-15T18:28:14.833731             "last_see        "20        2-          28:14.833731",
              "weight": 1
          {
            "id": "goa          ctive_pomera_use             "label": "ポメラの有効活用",
            "type"          l",
            "detail": せず、ポメラを自己成長に繋げたい              "status": "Active",
              "community": 1            "first_seen": "2026-02-15T18:28:14.833732             "last_see        "20        2-          28:14.833732",
                "weig          
          },
          {
            "id          ary:2026-02-14",
              "label": "2026-02-14             "type": ",
                "detail":           リ",
            "tags": [],
              "sentiment": 0.0,
                "date": "2026-02-14",
                  "analysis_content": "プロフェッショナルなライフコーチおよびデータアナリストとして、2026年2月14日の日記データを分析し、フィードバックとアクションプランを提示します。\n\n---\n\n# デイリーフィードバック＆アクションプラン：2026-02-14\n\n## 1. Plan vs Actual Analysis（計画と実績の分析）\n\n本日はマスターグラフに事前の予定が登録されていなかったため、今日の実績から現在のステータスを評価します。\n\n*   **完了したイベント**:\n    *   **ららぽーとへのお出かけ**: 家族や親族との交流、蒼馬さんの用品購入など、対人・家族面で非常に充実した時間を過ごせています（Sentiment 0.7）。\n*   **未達・課題のある目標**:\n    *   **ダイエット (Status: Active)**: 「がってん寿司」での食事やチュロスにより、目標に反する行動が発生しました。グラフ内の「べき思考（Should Statement）」というタグから、**「せっかくの外出だから楽しむべき」という誘惑と「節制すべき」という自責の板挟み**が伺えます。\n*   **進行中のプロジェクト**:\n    *   **LLM自己分析フローの構築**: JSON-LDの検討など、技術的な具体化が進んでいます。\n    *   **ポメラの有効活用**: 過去に3台の挫折経験がある中、明日の新型（スケルトンモデル）到着に向けて期待と緊張が混在しています。\n\n## 2. Meta-Cognition（メタ認知：思考のパターンとトリガー）\n\nデータから以下のパターンが特定されました：\n\n*   **「道具」への高い期待と過去のトラウマ**:\n    新しい道具（スケルトンポメラ）の購入に対する高揚感（Sentiment 1.0）がある一方で、過去の挫折（DM100/30/200）を明確に記憶しています。**「手に入れること」が目的化しやすい傾向**があることを自覚している点は、成長に向けた重要な一歩です。\n*   **「自由」と「構造」の葛藤**:\n    思考を妨げたくない「自由記述」へのこだわりと、LLMに理解させたい「構造化（JSON-LD）」の間でトレードオフが発生しています。これはあなたの知的好奇心と効率性の両立を求める性質を表しています。\n*   **食のトリガー**:\n    「がってん寿司の鯛の塩炙り」のように、**質の高い食体験に対してはダイエットの優先順位が下がりやすい**ようです。これを単なる「失敗」と捉えず、「特別な日の例外」として許容できるかが継続の鍵です。\n\n## 3. Context-Aware Advice（コンテキストに基づく助言）\n\n### **Keep：今後も継続すべきこと**\n*   **「書くこと」によるメンタルケア**: 「頭のモヤモヤが晴れる」という感覚（Sentiment 1.0）を大切にしてください。ポメラが届く前から、今の執筆フロー自体がすでにあなたの精神的安定に寄与しています。\n*   **家族との共有体験**: 良好な対人関係はすべての活動の基盤です。\n\n### **Problem：進捗を阻害している要因**\n*   **「べき思考」による自己否定**: ダイエット中の外食を「失敗」と定義しすぎると、モチベーションの減退を招きます。\n*   **ポメラの「所有」による満足**: 過去の挫折パターンは「買ったことで満足し、実運用が形骸化する」ことだった可能性があります。\n\n### **Try：明日への具体的なアクション**\n1.  **【明日：ポメラ到着イベント】への備え**:\n    *   明日は「設定」や「カスタマイズ」に時間を使いすぎず、まずは**「今の気持ちを10分だけ打つ」というスモールスタート**を徹底してください。\n    *   過去の機種で挫折した理由（例：重さ、起動速度、同期の面倒さなど）を、新しいスケルトンモデルでどう回避するか、ポメラ自身を使って「ポメラ会議」を自分と開催してみてください。\n2.  **【ダイエット】のリカバリー**:\n    *   明日は「ららぽーと」での摂取カロリーを相殺するため、軽めの食事、または15分程度のウォーキングを意識的に取り入れてください。\n3.  **【LLM構築】への一歩**:\n    *   「自由形式」と「構造化」を分けるアプローチを検討してください。まず自由に書き、その後にLLMを使って「抽出（JSON化）」させるという**後処理フロー**に振り切ることで、執筆時のストレスが軽減されます。\n\n---\n**コーチの一言**:\nスケルトンモデルのポメラ、楽しみで          の自分」に縛られず、「今の自分がどう書きたいか」を優先して、明日の到着を迎えましょう。"            "first_seen": "2026-02-15T18:28:14.833733             "last_see        "20        2-          28:14.833733",
                    "we           1
          },
          {
            "id"          cept:pomera",
               l": "ポメラ(DM250XG)",
            "type": "concept",
              "          ": "届いたばかりの黄色のスケルト          有欲を満たしてくれる            。",
                ime          .9,
                  "tags"                "Growth"
      ],
            "community": 1            "first_seen": "2026-02-15T18:28:40.946187             "last_see        "20        2-          28:40.946187",
              "weight": 1
            {
              "id": "projec          _analysis_flow",
                abel": "自己分析フローの構築",
              "type": "project"            "detail": "ポメラで何をす          務を明確にするためのプロセス設計。"            "status": "Act                "sentiment": 0.3,
              "community": 2            "first_seen": "2026-02-15T18:28:40.946189             "last_see        "20        2-          28:40.946189",
                "weight             },
              {
                "          emotion:excitement"            "label": "興奮と満足感",
                  "type": "emotio              "detail": "ポメラ          間の「買ってよかった」という強い                "sentiment": 1.0,
                    "community": 1            "first_seen": "2026-02-15T18:28:40.946190             "last_see        "20        2-          28:40.946190",
                      "weight":
              },
              {
                "id":           sustainable_use"            "label": "ポメラの継続的利用",
                "type": "go               "detail": "以前のよ          なることを防ぎ、活用,
                  "          ":           e",
                "tags"                "Growth"
      ],
                "community": 2            "first_seen": "2026-02-15T18:28:40.946192             "last_see        "20        2-          28:40.946192",
                  "weight": 1
                {
                  "id": "insight:co          e_load_risk",
                    l": "運用負荷による忌避のリスク",
                  "type": "insight",
                    "d          : "責務が不明確で負荷が重くなると、          れなくなる可能性があ            ",
                  "sentiment": -0.4,
                    "tags"                       gnitive Distorti          rtune Telling"
      ],
                  "community": 2            "first_seen": "2026-02-15T18:28:40.946193             "last_see        "20        2-          28:40.946193",
                    "weight": 1

                  {
                    "id": "even          _blog_failure",
                      label": "過去のブログ執筆の挫折",
                    "type": "event",
                      tail": "ブログを書く行為を重く感じ、ポ          くなってしまった過去の経験。",
            tatus": "Complet               "sentiment": -0.6,
                      "community": 2            "first_seen": "2026-02-15T18:28:40.946194             "last_see        "20        2-          28:40.946194",
                        "weig          
                  },
                  {
                    "id          ary:2026-02-15",
                      "label": "2026年2月15日                "type"          ry",
                        "detail          の悩みと減量の進捗についての記録",
                        gs": [],
                    "sentiment": 0.0,
                      "date": "2026-02-15",
                        "analysis_content": "ライフコーチ兼データアナリストとして、本日の記録（2026-02-15）とマスターコンテキストを統合し、分析とアクションプランを提示します。\n\n---\n\n# デイリーフィードバック＆アクションプラン：2026年2月15日\n\n## 1. Plan vs Actual Analysis（計画と実績の分析）\n\n*   **スケジュール達成度:**\n    *   **ポメラの到着（Scheduled）:** **達成。** メルカリで購入した「ポメラ DM250XG」が無事に手元に届き、所有欲が満たされている状態です（感情スコア 0.9）。予定通りのイベント発生により、ポジティブなエネルギーが生まれています。\n*   **目標への進捗:**\n    *   **ポメラの有効活用:** **順調な滑り出し。** 単に「使う」だけでなく、「自己分析フローの構築」というプロジェクトを即座に立ち上げ、過去の失敗（ブログ執筆の挫折）を繰り返さないための「仕組み化」に着手できています。\n    *   **ダイエット（Active Goal）:** **本日の言及なし。** 新しいガジェットへの興奮により、意識が「執筆・分析」に偏っています。過去のデータでは「寿司やチュロス」による脱線があったため、高揚感に伴う「お祝い食」などの誘惑に注意が必要です。\n\n## 2. Meta-Cognition（メタ認知：思考パターンの分析）\n\n*   **「ツールへの依存」から「運用への関心」への進化:**\n    過去のあなたは「ツールを買って満足し、重いタスク（ブログ等）を課して自滅する」パターンがありました。しかし、今回は**「運用負荷による忌避のリスク」を事前に予見（Fortune Telling）**しており、メタ認知能力が向上しています。\n*   **ポジティブ・トリガー:** \n    「限定品」「スケルトン」「新しいデバイス」といった視覚的・所有的な刺激が、あなたの活動エネルギーを最大化（感情スコア 1.0）させる強力なトリガーとなっています。\n*   **ネガティブ・トリガー:**\n    「責務の不明確さ」が不安（感情スコア 0.3）を生んでいます。これは、完璧主義的な傾向が「何をすべきか完璧に決めなければならない」というプレッシャーを生んでいる可能性を示唆しています。\n\n## 3. Context-Aware Advice（状況に合わせたアドバイス）\n\n### **Keep（継続すべきこと）**\n*   **「仕組み」からの着手:** ポメラを使い始める前に「自己分析フロー」を定義しようとする姿勢は素晴らしいです。デバイスを「魔法の杖」にせず、あくまで「筆記具」として位置づけようとする試みを続けてください。\n\n### **Problem（進捗を妨げている要因）**\n*   **認知負荷の過大評価:** 「自己分析を深めなければならない」という思いが強すぎると、ポメラを開くこと自体が「仕事」になってしまいます。過去のブログの挫折と同様、**「立派なアウトプットを出さなければならない」という心理的障壁**が再燃する兆しがあります。\n\n### **Try（明日への具体的な提案）**\n1.  **「5分間・無目的ブラインドタッチ」の実施:** \n    明日は「自己分析」という重いテーマを一度脇に置き、ただポメラの打鍵感を楽しむためだけに5分間、頭に浮かんだことを書き殴る（ジャーナリング）時間を設けてください。\n2.  **ダイエットとの接続:**\n    ポメラの機動性を活かし、食事の前に「今からこれを食べるが、体調にどう影響するか？」を一行だけポメラにメモしてください。新しいツールの興奮をダイエットの記録習慣に転用しましょう。\n3.  **「運用フロー」の簡略化:**\n    明日中に「自己分析フロー」を完成させる必要はありません。「ポメラを開く→日付を書く」という最小単位の動作を「成功」と定義し、運用のハードルを意識的に下げてください。\n\n---\n**コーチの一言:** \n新しい相棒（ポメラ）との出会い、おめでとうございます。その「黄色いスケルトン」が          考を透明にし、未来を書き換えるツールになることを期待しています。まずは「完璧な活用法」を          ら始めましょう。",
                          "first_seen": "2026-02-15T          40.946195",
                            "        _s          "2026-02 - 15T21: 11: 34.751962",
              ght": 1
                  },
                  {
                    "id": ew: weekly: 2026-02 - "label": "週次レビュー (2026-02-1               "type": "review",
                    "detail": "LLMによる週次振り返りと次週の提案",
                      "analysis_content": "熟練したライフコーチ兼データアナリストとして、あなたの過去1週間のデータを統合・分析し、自己成長のための「週次レビュー」を提示します。\n\n---\n\n# 週次レビュー: 2026-02-09 - 2026-02-15\n\n## 1. 📈 ハイライトとトレンド\n\n- **感情の推移**: \n  週の後半にかけて「期待」から「興奮・満足感」へと大きくポジティブなシフトが見られました。特に、希少なスケルトンポメラの購入（14日）から到着（15日）にかけて、デバイスへの所有欲が満たされると同時に、執筆活動への意欲が最高潮に達しています。一方で、ダイエットに関しては週末のイベント（外食）により、やや自己規律が揺らぎ、わずかな葛藤が見られる局面もありました。\n  \n- **主要イベント**: \n  1. **スケルトンポメラ (DM250XG) の入手**: メルカリでの即断即決から実機の到着まで、今週の最もポジティブなトリガーとなりました。\n  2. **ららぽーとでの家族時間**: 蒼馬（お子様）の用品購入や、家族・義父母との交流。社交的で充実した時間。\n  3. **LLM自己分析フローの概念構築**: 自由な執筆と構造化データ（JSON-LD）をどう組み合わせるかという、知的探求の開始。\n\n- **最大の成果 (Big Wins)**: \n  **「自分に最適な執筆環境の再定義」**です。過去に3度挫折したポメラというデバイスに対し、今回は「LLMによる自己分析」という明確な出口戦略を持って再挑戦を始めたことは、単なるガジェット購入以上の価値があります。\n\n## 2. 🎯 ゴール進捗分析\n\n- **現在のアクティブな戦略と結果**:\n  「日記による自己分析の自動化」というプロジェクトが始動しました。JSON-LDを用いた構造化データの検討など、技術的かつ論理的なアプローチが取られています。\n  \n- **特定されたブロッカー**:\n  - **運用の重さ（心理的ハードル）**: 過去に「ブログ執筆」という重い責務を課したことでポメラを挫折した経験。今回も「完璧に構造化しなくては」という思いが強すぎると、同様の挫折を招くリスクがあります。\n  - **自己管理の緩み**: 外食時の誘惑（がってん寿司、チュロス）に対し、ダイエット目標が後回しになる傾向。\n\n- **特定されたブースター**:\n  - **所有感と没入感**: 限定モデルのポメラを使うこと自体が、執筆の動機付け（やる気スイッチ）として強力に機能しています。\n  - **「頭のモヤモヤの解消」体験**: 日記を書くことで得られる精神的報酬が、習慣化の強い動機になっています。\n\n## 3. 💡 インサイトとパターン認識\n\n- **「自由」と「規律」のジレンマ**: \n  あなたは「思考を遮らない自由な記述」を好む一方で、LLMに正しく理解させるための「構造化」も重視しています。この両立が、現在のあなたの創造性の源泉であり、同時にストレスの種でもあります。\n  \n- **ポメラの歴史的パターン**: \n  過去に3モデルを手放した理由は、デバイスの問題ではなく「ポメラに課したタスクの重さ」にありました。「ポメラ＝アウトプット（ブログ）の場」ではなく、**「ポメラ＝思考の整理（自分との対話）の場」**と定義し直している現在の方向性は、非常に理にかなっています。\n\n- **認知の歪み（すべき思考）**:\n  「ダイエット中だからこれを食べてはいけない」という強い制約が、逆に食べた後の罪悪感を生んでいる可能性があります。イベント時の食事を「失敗」ではなく「計画的な休息」と捉えるリフレーミングが有効かもしれません。\n\n## 4. 🚀 来週の戦略 (Future Action)\n\n- **次週のフォーカスエリア**:\n  1. **「ポメラの責務」の固定化**: 来週は「清書」や「公開」を一切考えず、単なる「思考のダンプ（吐き出し）」に特化して使い、心理的ハードルを極限まで下げてください。\n  2. **LLMプロンプトの最小化**: JSON-LDの厳密さにこだわりすぎず、まずは「箇条書き」レベルの緩いルールでLLMに読み込ませ、運用の継続性を優先してください。\n  3. **食事のリカバリー戦略**: 週末の過剰摂取を調整するため、平日のタンパク質摂取と水分補給にフォーカスした食事管理を再設定してください。\n\n- **行動変容の提案**: \n  **「朝イチ5分のポメラ・セッション」**\n  夜の振り返りだけでなく、朝起きてすぐ、ポメラを開いて「今の気分」や「今日やりたいこと」を100文字程度打つだけのルーチンを取り入れてください。デバイスに触れること自体の「摩擦」をゼロにします。\n\n---\n\n**コーチのコメント**: \n新しいデバイスを手に、自分の思考をシステム化しようとする姿勢は素晴らしいです。過去の挫折を「データ」として捉え、今回の運用に活          メタ認知能力が高まっています。来週は「継続こ          析データになる」という意識で、気楽に          きましょう。",
                        "d          "2026-02 - 15",
                    "sentiment": 0.0,
                      nity": 10,
                    "first_seen": "2026-02-15T          40.656142",
                      ast_seen":         6-      -15      9:02:29.908        ,
                    "weight": 10,
                      "tags              },
                    {
                      "id": "event:pe          _cleaning",
                        l": "ペット部屋の掃除",
                      "t          "event",
                      "detail": "フローリングの粘着部分を剥がしてきれ          ",
                        "status": "Scheduled",
                          "date          26-02-15",
                          "s        me          0.2,
                      "community": 1            "first_seen": "2026-02-15T19:44:17.          ",
                        "last_seen":          -02 - 15T21: 11: 34.751966",
           weight": 15,
                      "tags": []
                    },
                    {
           id": "goal:clean_pet_room_habit",
                      "la          "ペット部屋をきれいに保                   ty          goal",
                      "status": "A          ,
                      "detail": "毎日の掃除をマストと捉えてい          難しいと感じている",
                        "tags"                "Cognitive Di          on: Should Statements",
                          "Habit"
                      "community": 1,
                        "first_seen": "2          -15T19:44:17        346                    st_seen": "2026-02-15T21:11:34.75          
                      "weight": 15
                    },
                    "id": "insi          icky_residue_proble              "label": "粘着部分が剥がせない悩み",
                    "type": "          t",
                      "detail": "爪とぎカバーの粘着がフローリングに残ってしま          
                    "sent        t": 4, "community": 1,
                      "first_see          026-02-15T19:44:17.435347",
                      "          een": "2026-02-15          :34.751974",
                        "we           15,
                    "tags": []
                  },
                  {
                    "id          rrier:time_poverty",
                      "label": "時間の不足"            "type": "c        pt"                    ail": "仕事の掛け持ちと育児により、掃除の習慣化に必要な時間          い",
                    "tags": [
                      flict"
                    ],
                      community": 1,
                _seen": "2026-02 - 15T19: 44: 17.435348",
                seen": "2026-02 - 15T21: 11: 34.751977",
                t": 15
                  } {
                    "goal:weight_loss_75kg",
                      "          : "今年の目標：体重75kg切り",
                    "type"          l",
                    "sta          "Active",
                    "de           "92kgから80.5kgまで減量済み。最終目標に向けた継続。",
                    "se          t": 0.8,
                      "tags": [
                        "Growth"
                        ,
                        "com        ty"        
           first_seen": "2026-02 - 15T19: 44: 1          49",
      "last_seen":          -02 - 15T21: 11: 34.751982",
           weight": 15
    },
                  {
                    ": "insight:weight_plateau",
                    "label":           期",
                    "type": "insight",
                      "detail"          g減量後、最近2週間ほど        動して        態"            "sentiment": -0.1,
              munity": 2,
                    "first_seen": "2          -15T19:44:17.435350             "last_seen": "2026 - 21: 11: 34.751986",
                    "weight": 15,
                : []
                  },
                  {
                    "id": "concept:chea          ,
                    "lab         "週        ート               "type": "concept",
                      "det          "飢餓状態を防ぐために普通の量を食べる。先週から開始。",           "community": 2,
             rst_seen": "2026-02 - 15T19: 4          35350",
                    "last_seen": "2026-02-15T21:11          1989",
                      "weight": 15,
                        "tags": [],
                        {
                          d":        nc          etary_restriction",
                          "label": 戦略",
      "type": "concept",
                          "d          : "1日1食（1200kcal程度）          減量法",
      "community": 2,
                          "first_seen": "2026-02-15T19:44:17.435351",
                          "last_seen": "2026-02-15T21:11:34.751992",
                          "weight": 15                   gs
                        }
  ],
                    "edges": [
                      "source": "person:self",
                      "targ          event:pomera_arrival             "type": "PLANS",
             bel": "到着を楽しみにしている",
      "first_seen": "20          15T18:28:14.833735",
                      "last_seen": "20          15T18:28:14.        35"                    ght": 1
    },
                  {
              rce": "person:self",
                    "target": "c          :skeleton_pomera",
                      "type": "DISCOVERS",
                        bel": "メルカリで見つけて購入した",
                    "first_seen": "          2-15T18:28:14.833736",
                      "last_seen": "          2-15T18:28:1        373                    eight": 1
                  },
                  {
            ource": "person:self",
                    "tar          "event:lalaport_tri              "type": "PARTICIPATES", "label": "家族で行った",
                      "first_seen": "202          5T18:28:14.833737",
                        "last_seen": "202          5T18:28:14.8        7", ht": 1
                  },
                  {
                    "source          ent:lalaport_trip",
                      et": "person:sayak              "type": "ABOUT",
                        ": "さやかと同行",
                    "first_seen": "2026-02-15          :14.833738",
                      "last_seen": "2026-02-15          :14.833738", gh
                  },
                  {
                    "source": "          lalaport_trip",
                      "target": "p          sayaka_parents",
                        pe": "ABOUT",
           label": "さやかの,
                      "first_seen": "2026-02-15T18:28:14.8          ,
                    "last_seen": "2026-02-15T18:28:14.        39"                    ght": 1
                  },
                  {
                    "so           "event:lalaport_trip",
                    "target          rson:souma",
                      "           "ABOUT",
               l": "蒼馬の用品を購入             "first_seen": "2026-02-15T18:28:14.833740             "last_seen": "2026-02 - 15T18: 28: 14.83374                   we           1
                  },
                  {
                    "source"          nt:lalaport_trip",
                    "target"          ce:gatten_sushi",
            ype": "AT",
             bel": "夕食を食べた             "first_seen": "2026-02-15T18:28:14.833741             "last_seen": "2026-02 - 15T18: 28: 14.83374                   we           1
                  },
                  {
                    "source"          ce:gatten_sushi",
                    "ta           "goal:diet",
                : "CONFLICTS_WI               "label":          ぎて食べ過ぎてしまった",
                      "first_seen": "2026-02-1          8:14.833742",
                        "last_seen": "2026-02-        8:2        .8          ,
                    "weight": 1
                  },
                  "source": "person:self"            "target": "project          nalysis",
                    ": "TARGETS",           "label": "構築を目指している",
                  "first_seen": "          2-15T18:28:14.833743",
                    "last_seen": 6 - 0        T1          4.833743",
                  "weight": 1
                  {
                    "source": "project:llm_          is",
                      "target": ept:json_ld",
                    type": "MENTI                "label": "フォーマットとして採用を検討",
                      "firs          ": "2026-02-15T18:28:14.833744",
                        "la        een        20          15T18:28:14.833744",
                        "we           1
                  },
                  {
                    "source": ct:llm_analysis",
            arget": "insigh          form_writing"            "type": "BARRIER",
                    "label": "記述の楽さと構          課題",
                      "first_seen": "2026-02-15T18:28        833        ,
                    "last_seen": "2026-02-15T18:28          3745",
                      "weight":
                  },
                  {
                    "sour          person:self",
                      target": "ins          ast_pomera_failure",
                    "type": "MENTIONS             "label": "過去の失敗を振り返る",
                    "first_see        "20        2 - 28: 14.833746",
                    "last_see          026-02-15T18:28:14.833746",
                      t": 1
                  },
                  {
           source": "perso          ",
                    "tar          "goal:effective_pomera_use",
                    "type": "          S",
                      "label": "今度こそ使いこなしたい",
                        "f        _se         "          2 - 15T18: 28: 14.833747",
                    "          een": "2026-02-15T18:28:14.83          
                    "weight": 1
                    {
                      "so           "person:self             "target": "emotion:writing_joy",
                        "t          "FEELING",
                      "label": "書くことに達成感を感じている"                   rs          ": "2026-02 - 15T18: 28: 14.833747             "last_seen": "2026-02-15T18:28:14.8          ,
                      "weight": 1

                      {
                        "s          : "emotion:wr          joy",
                        "target": "person:self",
                          "           "CAUSAL",
                        "label": "成長に繋がる実感を与えている"                   rs          ": "2026-02 - 15T18: 28: 14.833748             "last_seen": "2026-02-15T18:28:14.8337               "weight": 1
                        {
                          "sour          diary:2026-02                "target": "event:pomera_arrival",
              e": "MENTIONS",
                          "label": "言及",
                            igh        1, "first_seen": "2026-02-15T18:          833749",
                              "last_seen": "2026          T18:28:14.833749"
                          {
                            "sou          "diary: 2026 - 0
                            "target": "concept:skeleton_pomera",
                              "type": "MENTIONS",
                                "label": "言及",
                                  "w        t"               "first_seen": "2026-02-15          :14.833750",
                                    "last_seen": "2026-0          8:28:14.833750"
                            {
                              "sourc          iary:2026-02-               "target": "event:lalaport_trip",
                : "MENTIONS",
                                "label": "言及",
                                  "        ht"        
           first_seen": "2026-02 - 15T          14.833751",
                              "last_seen          26-02-15T18:28:14.833             },
                              {
                                "sou          "diary: 2026-02 - 14",
                                "target": "person:          ",
                                  "type": "MENTIONS",
                                    "label":
                                "weig         1,                    t_seen": "2026-02-15T18:2          33752",
                                  "last_seen": "2026          T18:28:14.833752"
                                {
                                  "source": "dia          6-02-14",
                                    "target": "person:souma",
                                      ype": "MENTIONS",
                                  "label": "言及",
                                    ght": 1,
           fir        ee          026-02 - 15T18: 28: 14.833753             "last_seen": "2026-02-15T18:28:14.833             },
                                  {
                                    "          ": "diary:2026-02-14"            "target": "person:sayaka_parents",
                                      "           "MENTIONS",
                                    "label": "言及",
                                      "we           1,
                                    "f        _se         "          2 - 15T18: 28: 14.833754",
            ast_seen": "2026-02 - 15T18: 28: 14.83
                                  },
                                  {
                e": "diary: 2026-02 - 14",
                t": "place:gatten_sushi",
                                    "type": "MEN          ,
                                    "label": "言及",
                                      "weight": 1,
                                        first_seen":        26-        5T          14.833754",
                                          "last_seen": "2026-02-          28:14.833754"
                                  },
                                  {
           source": "diary: 2 - 14",
                                    "target": "goal:          
                                    "type": "MENTIONS",
                                      "label": "言              "weight": 1,
                                    "first_seen": "2026-          18:28:14.833        ,
                                    "          een": "2026-02-15T18:28:14.833755"
                                  },
                                  "source": "diary:2026-02-14             "target": "proje          _analysis",
                                  "type":           ONS",
                                  "label": "言及",
                                    "weight": 1            "first_seen": "2026-02-15T18:28:14.833756             "last_see        "20        2-          28:14.833756"
                                },
                                {
                                  "sou          "diary: 2026-02 - 14",
                                  "target": "conc          on_ld",
                                    "typ          ENTIONS",
                                    "label": "言及",
                                      eight": 1,
                                  "first_seen": "2026-02-15T1          4.833757",
                                    "last_seen": "2026-02-15T1          4.833757"
          
                      ource": "diary: 2026-02 - 14",
                                  "targe          nsight:freeform_writing",
                                    "type": "          NS",
                                      "label",
                                      "weight": 1,
                                        "first          : "2026-02 - 15T18: 28: 14.833758",
                                  "last_           "2026-02 - 15T18: 28: 14.833758"
                                },
                                {
                                  "source": "d        :20        2-               "target": "insight:past_p          failure",
                                  "type": "MEN          ,
                                  "label": "言及             "weight": 1,           "first_seen"          6-02-15T18:28:14.833758",
                                    "last_seen":          -02 - 15T18: 28: 14.833758"
                                },
                                {
             urc        "d          026-02-14",
                                    "target": "e          :writing_joy",
                                      "type": "MENTIONS", "label": "言及",
                                        ght": 1,
                _seen": "2026          T18: 28: 14.833759",
                                  "last_seen": "2026-          18:28:14.833759"
                                },
                                {
                                  "sourc        "di        20          14",
                                  "target": "goal:eff          _pomera_use",
                                    "type": "MEN          ,
                                  "label": "言及             "weight": 1,           "first_seen"          6-02-15T18:28:14.833760",
                                    "last_seen":          -02 - 15T18: 28: 14.833760"
                                },
                                {
             urc        "p          self",
                                    "target": "concep          ra",
                                      "type": "DISCOVERS",
                                        abel": "所有欲が満たされる",
                                  "first_seen": "          2-15T18:28:40          4",
                                    "last_seen": "2026-02-15T18:28:40.          ",
                                      "weight": 1
                                },
                                {
                                  "s        e":        rs          f",
                                  "target": "emotion:e          ent",
                                    "type": "FEELING",
                                      "lab          買ってよかったと感じている",
                                      st_seen": "2026          T18: 28: 40.946                "last_seen": "2026-02-15T18:28:40.9462               "weight": 1
                                },
                                {
                                  "sourc        "pe:s                "target": "project:self_          is_flow",
                                    "type": "TARGETS",
                                      abel": "今日中に固めたい",
           first_seen": "2 - 15T18: 28: 40.          ",
                                  "last_seen": "2026-02-15T18:28:40.9          ,
                                  "weight": 1
                                },
                                {
                                  "so        ":         so          ",
                                  "target": "goal:sustainable_u               "type": "TARGETS",
                                  ": "以前のようにならないよう気
                                  "first_seen": "          2-15T18:28:40          8",
                                    "last_seen": "2026-02-15T18:28:40.          ",
                                      "weight": 1
                                },
                                {
                                  "s        e":        oj          lf_analysis_flow",
                                  "target": "co          pomera",
                                    "type": "ABOUT"            "label": "ポメラで行          定義する",
                                      "first_se          2026-02-15T18          .946209",
                                      "last_seen": "2026-02-15T18:          946209",
                                        "weight": 1
                                },
                                {
                                  "s      rce       "insight:cogn        e_load_risk",
                                  "target": "goal:sustaina        use",
                                    "type": "BARRIER",
                                      "label":         増大が継続を阻害する",
             rst_seen": "2026 - -1    5T18: 28: 40.946210",
                                  "last_seen": "2026-02-15T18:28:40.946210",
                                    "weight": 1
                                },
                                {
                                  "source": "event:past_blog_failure",
                                    "target": "insight:cognitive_load_risk",
                                      "type": "CAUSAL",
                                        "label": "過去の重荷感がリスクへの警戒を生んでいる",
                                          "first_seen": "2026-02-15T18:28:40.946211",
                                            "last_seen": "2026-02-15T18:28:40.946211",
                                              "weight": 1
                                },
                                {
                                  "source": "project:self_analysis_flow",
                                    "target": "insight:cognitive_load_risk",
                                      "type": "SOLVES",
                                        "label": "責務をはっきりさせることで負荷を軽減する",
                                          "first_seen": "2026-02-15T18:28:40.946212",
                                            "last_seen": "2026-02-15T18:28:40.946212",
                                              "weight": 1
                                },
                                {
                                  "source": "diary:2026-02-15",
                                    "target": "concept:pomera",
                                      "type": "MENTIONS",
                                        "label": "言及",
                                          "weight": 1,
                                            "first_seen": "2026-02-15T18:28:40.946213",
                                              "last_seen": "2026-02-15T18:28:40.946213"
                                },
                                {
                                  "source": "diary:2026-02-15",
                                    "target": "project:self_analysis_flow",
                                      "type": "MENTIONS",
                                        "label": "言及",
                                          "weight": 1,
                                            "first_seen": "2026-02-15T18:28:40.946215",
                                              "last_seen": "2026-02-15T18:28:40.946215"
                                },
                                {
                                  "source": "diary:2026-02-15",
                                    "target": "emotion:excitement",
                                      "type": "MENTIONS",
                                        "label": "言及",
                                          "weight": 1,
                                            "first_seen": "2026-02-15T18:28:40.946215",
                                              "last_seen": "2026-02-15T18:28:40.946215"
                                },
                                {
                                  "source": "diary:2026-02-15",
                                    "target": "goal:sustainable_use",
                                      "type": "MENTIONS",
                                        "label": "言及",
                                          "weight": 1,
                                            "first_seen": "2026-02-15T18:28:40.946216",
                                              "last_seen": "2026-02-15T18:28:40.946216"
                                },
                                {
                                  "source": "diary:2026-02-15",
                                    "target": "insight:cognitive_load_risk",
                                      "type": "MENTIONS",
                                        "label": "言及",
                                          "weight": 1,
                                            "first_seen": "2026-02-15T18:28:40.946217",
                                              "last_seen": "2026-02-15T18:28:40.946217"
                                },
                                {
                                  "source": "diary:2026-02-15",
                                    "target": "event:past_blog_failure",
                                      "type": "MENTIONS",
                                        "label": "言及",
                                          "weight": 1,
                                            "first_seen": "2026-02-15T18:28:40.946218",
                                              "last_seen": "2026-02-15T18:28:40.946218"
                                },
                                {
                                  "source": "review:weekly:2026-02-15",
                                    "target": "diary:2026-02-14",
                                      "type": "ABOUT",
                                        "label": "対象期間として集計",
                                          "weight": 2,
                                            "first_seen": "2026-02-15T18:43:40.656154",
                                              "last_seen": "2026-02-15T19:02:29.908049"
                                },
                                {
                                  "source": "review:weekly:2026-02-15",
                                    "target": "diary:2026-02-15",
                                      "type": "ABOUT",
                                        "label": "対象期間として集計",
                                          "weight": 2,
                                            "first_seen": "2026-02-15T18:43:40.656156",
                                              "last_seen": "2026-02-15T19:02:29.908051"
                                },
                                {
                                  "source": "person:self",
                                    "target": "diary:2026-02-15",
                                      "type": "MENTIONS",
                                        "label": "記述する",
                                          "first_seen": "2026-02-15T19:44:17.435361",
                                            "last_seen": "2026-02-15T21:11:34.752017",
                                              "weight": 15
                                },
                                {
                                  "source": "person:self",
                                    "target": "event:pet_room_cleaning",
                                      "type": "PLANS",
                                        "label": "掃除を予定する",
                                          "first_seen": "2026-02-15T19:44:17.435363",
                                            "last_seen": "2026-02-15T21:11:34.752019",
                                              "weight": 15
                                },
                                {
                                  "source": "person:self",
                                    "target": "goal:clean_pet_room_habit",
                                      "type": "TARGETS",
                                        "label": "習慣化を目指す",
                                          "first_seen": "2026-02-15T19:44:17.435364",
                                            "last_seen": "2026-02-15T21:11:34.752021",
                                              "weight": 15
                                },
                                {
                                  "source": "person:self",
                                    "target": "insight:sticky_residue_problem",
                                      "type": "FEELING",
                                        "label": "悩んでいる",
                                          "first_seen": "2026-02-15T19:44:17.435365",
                                            "last_seen": "2026-02-15T21:11:34.752023",
                                              "weight": 15
                                },
                                {
                                  "source": "barrier:time_poverty",
                                    "target": "goal:clean_pet_room_habit",
                                      "type": "BARRIER",
                                        "label": "習慣化を阻害する",
                                          "first_seen": "2026-02-15T19:44:17.435366",
                                            "last_seen": "2026-02-15T21:11:34.752025",
                                              "weight": 15
                                },
                                {
                                  "source": "person:self",
                                    "target": "goal:weight_loss_75kg",
                                      "type": "TARGETS",
                                        "label": "目標に設定する",
                                          "first_seen": "2026-02-15T19:44:17.435367",
                                            "last_seen": "2026-02-15T21:11:34.752027",
                                              "weight": 15
                                },
                                {
                                  "source": "concept:cheat_day",
                                    "target": "insight:weight_plateau",
                                      "type": "SOLVES",
                                        "label": "停滞期打破のための対策",
                                          "first_seen": "2026-02-15T19:44:17.435367",
                                            "last_seen": "2026-02-15T21:11:34.752029",
                                              "weight": 15
                                },
                                {
                                  "source": "concept:dietary_restriction",
                                    "target": "goal:weight_loss_75kg",
                                      "type": "TARGETS",
                                        "label": "減量目標達成の手段",
                                          "first_seen": "2026-02-15T19:44:17.435368",
                                            "last_seen": "2026-02-15T21:11:34.752031",
                                              "weight": 15
                                },
                                {
                                  "source": "insight:weight_plateau",
                                    "target": "concept:cheat_day",
                                      "type": "TRIGGERED_BY",
                                        "label": "停滞をきっかけに導入",
                                          "first_seen": "2026-02-15T19:44:17.435369",
                                            "last_seen": "2026-02-15T21:11:34.752032",
                                              "weight": 15
                                }
  ],
                                "metadata": {
                                  "created_at": "2026-02-15T18:27:41.189275",
                                    "last_updated": "2026-02-15T21:11:34.752038",
                                      "node_count": 32,
                                        "edge_count": 54
                                }
                              };
                              // GRAPH_DATA_END

                              // STATE_INIT
                              const state = {
                                selectedNodeId: null,
                                mode: 'default', // default, sentiment, community
                                highlightDistortion: false
                              };

                              const colorMap = {
                                "self": "#f43f5e",
                                "person": "#3b82f6",
                                "event": "#f59e0b",
                                "place": "#10b981",
                                "project": "#8b5cf6",
                                "emotion": "#ec4899",
                                "insight": "#06b6d4",
                                "concept": "#64748b",
                                "goal": "#ef4444",
                                "diary": "#94a3b8",
                                "review": "#fbbf24"
                              };

                              const communityColors = d3.schemeTableau10;

                              // ── Pre-process Data (Filter Diary/Review Nodes) ──
                              const journalTypes = new Set(['diary', 'review']);

                              // Separate nodes
                              const graphNodes = GRAPH_DATA.nodes.filter(n => !journalTypes.has(n.type));
                              const journalNodes = GRAPH_DATA.nodes.filter(n => journalTypes.has(n.type));

                              // Create specific edges for simulation (only those between graph nodes)
                              const graphNodeIds = new Set(graphNodes.map(n => n.id));
                              // D3 links need references to nodes or specific IDs. 
                              // Since data.edges might use 'source'/'target' as strings initially, we filter them.
                              const graphEdges = GRAPH_DATA.edges.filter(e => {
                                const s = typeof e.source === 'object' ? e.source.id : e.source;
                                const t = typeof e.target === 'object' ? e.target.id : e.target;
                                return graphNodeIds.has(s) && graphNodeIds.has(t);
                              }).map(e => ({ ...e })); // Clone to avoid mutating original if needed

                              // Sort Journal Nodes by Date Descending
                              journalNodes.sort((a, b) => {
                                const dateA = a.date || a.first_seen || "";
                                const dateB = b.date || b.first_seen || "";
                                return dateB.localeCompare(dateA);
                              });

                              // Populate Sidebar Journal List
                              const journalList = document.getElementById('journal-list');
                              if (journalList) {
                                journalList.innerHTML = '';
                                journalNodes.forEach(d => {
                                  const item = document.createElement('div');
                                  item.style.padding = '10px';
                                  item.style.borderBottom = '1px solid #334155';
                                  item.style.cursor = 'pointer';
                                  item.style.transition = 'background 0.2s';

                                  item.onmouseover = () => item.style.background = '#334155';
                                  item.onmouseout = () => item.style.background = 'transparent';

                                  const typeColor = d.type === 'review' ? '#fbbf24' : '#94a3b8';
                                  const label = d.label || d.id;
                                  const dateStr = d.date || label;

                                  item.innerHTML = `
                <div style="display:flex; align-items:center; gap:8px;">
                    <div style="width:8px; height:8px; border-radius:50%; background:${typeColor}"></div>
                    <div style="font-weight:600; font-size:12px; color:#f1f5f9;">${d.type === 'review' ? '週次レビュー' : '日記'}</div>
                </div>
                <div style="font-size:11px; color:#cbd5e1; margin-top:4px; margin-left:16px;">${dateStr}</div>
            `;

                                  item.onclick = (e) => {
                                    e.stopPropagation();
                                    updateDetailPanel(d);
                                    highlightConnectedNodes(d.id);
                                  };
                                  journalList.appendChild(item);
                                });
                              }

                              // ── Visualization Setup ──
                              const container = document.getElementById('graph-container');
                              const width = container.clientWidth;
                              const height = container.clientHeight;
                              const tooltip = document.getElementById('tooltip');

                              const svg = d3.select('#graph-container').append('svg')
                                .attr('width', '100%').attr('height', '100%')
                                .attr('viewBox', [0, 0, width, height]);

                              const g = svg.append('g');

                              // Zoom
                              const zoom = d3.zoom().scaleExtent([0.1, 8]).on('zoom', (e) => g.attr('transform', e.transform));
                              svg.call(zoom);

                              // Markers
                              const defs = svg.append('defs');
                              ['arrow-default', 'arrow-causal'].forEach(id => {
                                defs.append('marker')
                                  .attr('id', id)
                                  .attr('viewBox', '0 -5 10 10')
                                  .attr('refX', 18).attr('refY', 0)
                                  .attr('markerWidth', 6).attr('markerHeight', 6)
                                  .attr('orient', 'auto')
                                  .append('path').attr('d', 'M0,-5L10,0L0,5')
                                  .attr('fill', id === 'arrow-causal' ? '#f472b6' : '#64748b');
                              });

                              // Simulation
                              let simulation = d3.forceSimulation(graphNodes)
                                .force('link', d3.forceLink(graphEdges).id(d => d.id).distance(100))
                                .force('charge', d3.forceManyBody().strength(-300))
                                .force('center', d3.forceCenter(width / 2, height / 2))
                                .force('collide', d3.forceCollide().radius(d => getRadius(d) + 10));

                              // Elements
                              const linkGroup = g.append('g').attr('class', 'links');
                              const nodeGroup = g.append('g').attr('class', 'nodes');

                              let link = linkGroup.selectAll('line').data(graphEdges).join('line')
                                .attr('stroke-width', d => d.type === 'CAUSAL' ? 2 : 1)
                                .attr('stroke', '#475569')
                                .attr('marker-end', d => d.type === 'CAUSAL' ? 'url(#arrow-causal)' : 'url(#arrow-default)');

                              let node = nodeGroup.selectAll('g').data(graphNodes).join('g')
                                .call(d3.drag().on('start', dragstarted).on('drag', dragged).on('end', dragended));

                              const circles = node.append('circle')
                                .attr('r', d => getRadius(d))
                                .attr('fill', d => getColor(d))
                                .attr('stroke', '#fff')
                                .attr('stroke-width', 0);

                              const labels = node.append('text')
                                .attr('dx', d => getRadius(d) + 5).attr('dy', 4)
                                .text(d => d.label)
                                .attr('fill', '#e2e8f0')
                                .style('font-size', '11px')
                                .style('pointer-events', 'none')
                                .style('text-shadow', '0 1px 4px rgba(0,0,0,0.8)');

                              // Events
                              svg.on('click', (e) => {
                                if (e.target.tagName === 'svg') {
                                  state.selectedNodeId = null;
                                  resetHighlight();
                                  document.getElementById('detail-panel').innerHTML = '<div class="detail-empty">ノードをクリックして詳細を表示</div>';
                                }
                              });

                              node.on('click', (e, d) => {
                                e.stopPropagation();
                                state.selectedNodeId = d.id;
                                updateDetailPanel(d);
                                highlightNode(d);
                              });

                              node.on('mouseover', (e, d) => {
                                tooltip.style.opacity = 1;
                                tooltip.innerHTML = `
        <div style="font-weight:700; margin-bottom:4px; color:${getColor(d)}">${d.label}</div>
        <div style="font-size:10px; color:#94a3b8">${d.type}</div>
        ${d.sentiment ? `<div style="margin-top:4px;">Sentiment: ${d.sentiment}</div>` : ''}
      `;
                                tooltip.style.left = (e.pageX + 10) + 'px';
                                tooltip.style.top = (e.pageY - 10) + 'px';
                              }).on('mouseout', () => tooltip.style.opacity = 0);

                              simulation.on('tick', () => {
                                link
                                  .attr('x1', d => d.source.x).attr('y1', d => d.source.y)
                                  .attr('x2', d => d.target.x).attr('y2', d => d.target.y);
                                node.attr('transform', d => `translate(${d.x},${d.y})`);
                              });

                              // ── Functions ──

                              function getRadius(d) {
                                return d.id === 'person:self' ? 18 : (d.weight ? 5 + d.weight * 1.5 : 8);
                              }

                              function getColor(d) {
                                if (state.mode === 'sentiment') {
                                  if (!d.sentiment) return '#475569';
                                  return d.sentiment > 0 ? '#34d399' : '#f87171';
                                }
                                if (state.mode === 'community') {
                                  return communityColors[d.community % 10] || '#94a3b8';
                                }
                                return colorMap[d.type] || '#94a3b8';
                              }

                              function setMode(de)  state.mode = mode;
                              document.querySelectorAll('.mode-btn').forEach(el => el.classList.remove('active'));
                              // Safety check for button existence
                              const btn = document.querySelector(`.mode-btn[onclick="setMode('${mode}')"]`);
                              if (btn) btn.classList.add('active');

                              circles.transition().duration(500).attr('fill', d => getColor(d));

                              const info = document.getElementById('info-box');
                              if (info) {
                                if (mode === 'sentiment') info.style.display = 'block';
                                else if (mode === 'community') info.style.display = 'block';
                                else info.style.display = 'none';
                              }
                            }

                            function toggleDistortion() {
                              state.highlightDistortion = !state.highlightDistortion;
                              circles.transition().duration(300)
                                .attr('stroke', d => {
                                  if (state.highlightDistortion && d.tags && d.tags.some(t => t.includes('Cognitive Distortion'))) {
                                    return '#f43f5e';
                                  }
                                  return '#fff';
                                })
                                .attr('stroke-width', d => {
                                  if (state.highlightDistortion && d.tags && d.tags.some(t => t.includes('Cognitive Distortion'))) {
                                    return 4;
                                  }
                                  return 0;
                                });
                            }

                            // Highlighting Logic

                            // Highlight a visible node in the graph
                            function highlightNode(d) {
                              const connectedNodeIds = new Set();
                              connectedNodeIds.add(d.id);

                              GRAPH_DATA.edges.forEach(l => {
                                // Check original edges for connections
                                const s = (typeof l.source === 'object') ? l.source.id : l.source;
                                const t = (typeof l.target === 'object') ? l.target.id : l.target;

                                if (s === d.id) connectedNodeIds.add(t);
                                if (t === d.id) connectedNodeIds.add(s);
                              });

                              circles.transition().attr('opacity', n => connectedNodeIds.has(n.id) ? 1 : 0.1);
                              link.transition().attr('opacity', l => (l.source.id === d.id || l.target.id === d.id) ? 1 : 0.05);
                              labels.transition().attr('opacity', n => connectedNodeIds.has(n.id) ? 1 : 0.1);
                            }

                            // Highlight nodes connected to a hidden journal node
                            function highlightConnectedNodes(journalId) {
                              const connectedNodeIds = new Set();
                              // Look up connections in ALL edges
                              GRAPH_DATA.edges.forEach(l => {
                                const s = (typeof l.source === 'object') ? l.source.id : l.source;
                                const t = (typeof l.target === 'object') ? l.target.id : l.target;

                                if (s === journalId) connectedNodeIds.add(t);
                                if (t === journalId) connectedNodeIds.add(s);
                              });

                              // Update visual elements
                              circles.transition().attr('opacity', n => connectedNodeIds.has(n.id) ? 1 : 0.1);
                              link.transition().attr('opacity', 0.05); // Hide all links as the journal node isn't there
                              labels.transition().attr('opacity', n => connectedNodeIds.has(n.id) ? 1 : 0.1);
                            }

                            function resetHighlight() {
                              circles.transition().attr('opacity', 1);
                              link.transition().attr('opacity', 1);
                              labels.transition().attr('opacity', 1);
                            }

                            function resetZoom() {
                              svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity);
                            }

                            // UI Updates
                            function updateDetailPanel(d) {
                              const panel = document.getElementById('detail-panel');
                              let html = `
        <div class="detail-header" style="border-left: 4px solid ${getColor(d)}; padding-left: 10px;">
          <div style="font-size:10px; font-weight:700; color:#94a3b8; text-transform:uppercase;">${d.type}</div>
          <div class="detail-label" style="font-size:18px; font-weight:700; color:#fff;">${d.label}</div>
        </div>
        <div class="detail-content">
          <div style="margin-bottom:12px; font-size:14px; color:#cbd5e1; line-height:1.6;">${d.detail || '詳細情報なし'}</div>
        </div>
      `;

                              if (d.tags && d.tags.length > 0) {
                                html += `
        <div class="tags-container" style="display:flex; gap:6px; flex-wrap:wrap; margin-bottom:16px;">
            ${d.tags.map(t => `<span class="tag" style="background:#334155; color:#94a3b8; padding:3px 8px; border-radius:4px; font-size:10px; border:1px solid #475569;">${t}</span>`).join('')}
        </div>`;
                              }

                              // Render Analysis Report if available
                              if (d.analysis_content) {
                                html += `
          <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #475569;">
            <strong style="color: #f472b6; font-size:12px; display:block; margin-bottom:8px;">📊 AI Analysis Report</strong>
            <div class="markdown-body" style="font-size: 13px; line-height: 1.7; color:#e2e8f0; background:#1e293b; padding:15px; border-radius:8px; border:1px solid #334155;">
              ${marked.parse(d.analysis_content)}
            </div>
          </div>
        `;
                              }

                              panel.innerHTML = html;
                            }

                            // Drag Functions
                            function dragstarted(e, d) {
                              if (!e.active) simulation.alphaTarget(0.3).restart();
                              d.fx = d.x; d.fy = d.y;
                            }
                            function dragged(e, d) {
                              d.fx = e.x; d.fy = e.y;
                            }
                            function dragended(e, d) {
                              if (!e.active) simulation.alphaTarget(0);
                              d.fx = null; d.fy = null;
                            }

                            // Keyboard Reset
                            window.resetZoom = resetZoom;

                            // ── Future Goals Rendering (Right Sidebar) ──
                            function renderFutureGoals() {
                              const container = document.getElementById('goal-list');
                              if (!container) return;
                              container.innerHTML = '';

                              // Filter for Goals and Events
                              const goals = GRAPH_DATA.nodes.filter(n =>
                                (n.type === 'goal' && n.status === 'Active') ||
                                (n.type === 'event' && n.status === 'Scheduled')
                              );

                              // Sort: Events by Date (Asc), Goals by Weight (Desc)
                              goals.sort((a, b) => {
                                if (a.type === 'event' && b.type === 'event') {
                                  return (a.date || '9999').localeCompare(b.date || '9999');
                                }
                                if (a.type === 'event') return -1;
                                if (b.type === 'event') return 1;
                                return b.weight - a.weight;
                              });

                              if (goals.length === 0) {
                                container.innerHTML = '<div style="color:#64748b; font-size:12px; text-align:center; padding:20px;">No active goals or scheduled events.</div>';
                                return;
                              }

                              goals.forEach(node => {
                                const div = document.createElement('div');
                                div.className = 'goal-item';
                                // Check if focusNode is available
                                div.onclick = () => { if (typeof focusNode === 'function') focusNode(node); };
                                div.style.cursor = 'pointer';

                                let dateDisplay = '';
                                if (node.date) dateDisplay = `<div class="goal-date">📅 ${node.date}</div>`;

                                let typeLabel = node.type === 'event' ? 'SCHEDULED' : 'ACTIVE GOAL';
                                let typeClass = node.type;

                                div.innerHTML = `
                                  <div class="goal-type ${typeClass}">${typeLabel}</div>
                                  ${dateDisplay}
                                  <div class="goal-label">${node.label}</div>
                                `;
                                container.appendChild(div);
                              });
                            }

                            // Initial Trigger
                            renderFutureGoals();
                            setMode('default');
  </script>
</body>

</html>