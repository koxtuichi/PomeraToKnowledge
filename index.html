<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ポメラ ナレッジグラフ (Enhanced)</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', 'Hiragino Sans', 'Meiryo', sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      overflow: hidden;
    }

    #app {
      display: flex;
      height: 100vh;
    }

    /* ── サイドバー（左） ── */
    #sidebar {
      width: 320px;
      background: #1e293b;
      border-right: 1px solid #334155;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      flex-shrink: 0;
      box-shadow: 4px 0 24px rgba(0, 0, 0, 0.2);
      z-index: 10;
    }

    /* ── サイドバー（右：Future Goals） ── */
    #right-sidebar {
      width: 280px;
      background: #1e293b;
      border-left: 1px solid #334155;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      flex-shrink: 0;
      box-shadow: -4px 0 24px rgba(0, 0, 0, 0.2);
      z-index: 10;
    }

    #sidebar-header,
    #right-sidebar-header {
      padding: 20px;
      border-bottom: 1px solid #334155;
      background: linear-gradient(135deg, #1e293b, #0f172a);
    }

    #right-sidebar-header h2 {
      font-size: 16px;
      font-weight: 700;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .goal-list {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }

    .goal-item {
      background: rgba(30, 41, 59, 0.5);
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      transition: all 0.2s;
    }

    .goal-item:hover {
      background: #334155;
      border-color: #475569;
    }

    .goal-type {
      font-size: 10px;
      text-transform: uppercase;
      font-weight: 700;
      color: #94a3b8;
      margin-bottom: 4px;
      display: inline-block;
      padding: 2px 6px;
      border-radius: 4px;
      background: #0f172a;
    }

    .goal-type.event {
      color: #f472b6;
    }

    .goal-type.goal {
      color: #34d399;
    }

    .goal-date {
      font-size: 11px;
      color: #cbd5e1;
      margin-bottom: 4px;
    }

    .goal-label {
      font-size: 13px;
      font-weight: 600;
      color: #e2e8f0;
      line-height: 1.4;
    }

    /* ── コントロール ── */
    #controls {
      padding: 20px;
      border-bottom: 1px solid #334155;
      overflow-y: auto;
    }

    .control-group {
      margin-bottom: 20px;
    }

    .control-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #64748b;
      font-weight: 700;
      margin-bottom: 10px;
    }

    select,
    input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      background: #0f172a;
      border: 1px solid #334155;
      border-radius: 8px;
      color: #e2e8f0;
      font-size: 13px;
      margin-bottom: 12px;
      transition: all 0.2s;
    }

    select:focus,
    input[type="text"]:focus {
      outline: none;
      border-color: #60a5fa;
      box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.2);
    }

    /* Mode Switcher */
    .mode-switch {
      display: flex;
      background: #0f172a;
      border-radius: 8px;
      padding: 4px;
      border: 1px solid #334155;
      margin-bottom: 12px;
    }

    .mode-btn {
      flex: 1;
      text-align: center;
      padding: 6px;
      font-size: 12px;
      border-radius: 6px;
      cursor: pointer;
      color: #94a3b8;
      transition: all 0.2s;
    }

    .mode-btn.active {
      background: #334155;
      color: #fff;
      font-weight: 600;
    }

    .toggle-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 13px;
      color: #cbd5e1;
      cursor: pointer;
      padding: 4px 0;
    }

    .toggle-row:hover {
      color: #fff;
    }

    .toggle-row input {
      accent-color: #f472b6;
    }

    /* ── 詳細パネル ── */
    #detail-panel {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    .detail-card {
      background: linear-gradient(180deg, #1e293b, #0f172a);
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .detail-card h3 {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
    }

    .sentiment-badge {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 12px;
      background: #334155;
      font-weight: 600;
    }

    .badge-pos {
      background: rgba(52, 211, 153, 0.2);
      color: #34d399;
    }

    .badge-neg {
      background: rgba(248, 113, 113, 0.2);
      color: #f87171;
    }

    .badge-neu {
      background: rgba(148, 163, 184, 0.2);
      color: #94a3b8;
    }

    .detail-card .detail-text {
      font-size: 14px;
      color: #cbd5e1;
      line-height: 1.7;
      margin-bottom: 16px;
    }

    .tags-container {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 16px;
    }

    .tag {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 4px;
      background: #334155;
      color: #94a3b8;
      border: 1px solid #475569;
    }

    .tag.distortion {
      background: rgba(244, 63, 94, 0.15);
      border-color: rgba(244, 63, 94, 0.4);
      color: #fb7185;
    }

    /* ── グラフコンテナ ── */
    #graph-container {
      flex: 1;
      position: relative;
      background: radial-gradient(circle at center, #1e293b 0%, #0f172a 70%);
    }

    svg {
      width: 100%;
      height: 100%;
    }

    /* ── ツールチップ ── */
    .tooltip {
      position: absolute;
      padding: 12px 16px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid #475569;
      border-radius: 8px;
      font-size: 12px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.15s;
      max-width: 320px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      z-index: 100;
    }

    /* ── 凡例 ── */
    .legend {
      position: absolute;
      bottom: 24px;
      right: 24px;
      background: rgba(30, 41, 59, 0.9);
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 16px 20px;
      font-size: 11px;
      backdrop-filter: blur(8px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .legend h5 {
      color: #94a3b8;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .legend-line {
      width: 20px;
      height: 2px;
    }

    /* Modal Styles */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: #1e293b;
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      border-radius: 12px;
      border: 1px solid #475569;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid #334155;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: #f472b6;
    }

    .close-btn {
      background: none;
      border: none;
      color: #94a3b8;
      font-size: 24px;
      cursor: pointer;
      line-height: 1;
      padding: 0;
    }

    .close-btn:hover {
      color: #fff;
    }

    .modal-body {
      padding: 24px;
      overflow-y: auto;
      font-size: 16px;
      line-height: 1.8;
      color: #e2e8f0;
      font-family: "Yu Mincho", serif;
      /* Narrative style */
    }

    .modal-body p {
      margin-bottom: 1.5em;
    }
  </style>
</head>

<body>
  <div id="app">
    <div id="sidebar">
      <div id="sidebar-header">
        <h1>ポメラ ナレッジグラフ</h1>
        <div class="stats" id="stats"></div>
      </div>

      <div id="controls">
        <div class="control-group">
          <div class="control-title">Analysis Mode</div>
          <div class="mode-switch">
            <div class="mode-btn active" onclick="setMode('default')">標準</div>
            <div class="mode-btn" onclick="setMode('sentiment')">感情分析</div>
            <div class="mode-btn" onclick="setMode('community')">コミュニティ</div>
          </div>
        </div>

        <div class="control-group">
          <div class="control-title">Search & Filter</div>
          <input type="text" id="search-input" placeholder="ノードを検索...">
          <label class="toggle-row">
            <input type="checkbox" id="highlight-distortion" onchange="toggleDistortion()">
            ⚠️ 認知の歪み (CBT) を強調
          </label>
        </div>

        <div class="control-group">
          <div class="control-title">Edge Filters</div>
          <div class="edge-toggle" id="edge-toggles">
            <!-- JSで生成 -->
          </div>
        </div>

        <div id="info-box"
          style="margin-top:20px; padding:12px; background:#334155aa; border-radius:8px; font-size:12px; display:none;">
          <strong style="color:#f472b6">💡 Analysis Insight</strong><br>
          <button onclick="resetZoom()">Zoom Reset</button>
        </div>

      </div>

      <div id="journal-list-container" style="flex: 1; overflow-y: auto; border-bottom: 1px solid #334155;">
        <div class="control-title" style="padding: 15px 20px 5px;">📜 Journal & Reviews</div>
        <div id="journal-list" style="padding: 0 15px 15px;">
          <!-- JS Populated -->
        </div>
      </div>

      <div id="detail-panel" style="flex: 1; border-top: 1px solid #334155;">
        <div class="detail-empty">ノードをクリックして詳細を表示</div>
      </div>
    </div>

    <div id="graph-container">
      <div class="tooltip" id="tooltip"></div>
      <div class="legend" id="legend">
        <!-- JSで生成 -->
      </div>
    </div>

    <!-- 右サイドバー -->
    <div id="right-sidebar">
      <div id="right-sidebar-header">
        <h2>Future Goals & Events</h2>
      </div>
      <div class="goal-list" id="goal-list">
        <!-- JS Populated -->
      </div>
    </div>
  </div>

  <!-- Analysis Modal -->
  <div id="analysis-modal" class="modal-overlay" onclick="closeModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-title">📊 AI Analysis Report</div>
        <button class="close-btn" onclick="closeModal()">&times;</button>
      </div>
      <div id="modal-body" class="modal-body markdown-body">
        <!-- Content injected here -->
      </div>
    </div>
  </div>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>

    // ── データ（LLM抽出シミュレーション） ──

    // GRAPH_DATA_START
    const GRAPH_DATA = {
  "nodes": [
    {
      "id": "person:self",
      "label": "自分",
      "type": "self",
      "detail": "日記の筆者。33歳。仕事を2つ掛け持ちしながら子育て中。",
      "sentiment": 0.1,
      "community": 0,
      "first_seen": "2026-02-15T18:28:14.833713",
      "last_seen": "2026-02-16T00:39:23.912599",
      "weight": 18,
      "tags": []
    },
    {
      "id": "event:pomera_arrival",
      "label": "ポメラの到着",
      "type": "event",
      "detail": "メルカリで購入したスケルトンのポメラが届く予定。",
      "sentiment": 0.9,
      "status": "Scheduled",
      "date": "2026-02-15",
      "tags": [
        "Excitement",
        "Shopping"
      ],
      "community": 1,
      "first_seen": "2026-02-15T18:28:14.833719",
      "last_seen": "2026-02-15T18:28:14.833719",
      "weight": 1
    },
    {
      "id": "concept:skeleton_pomera",
      "label": "スケルトンポメラ",
      "type": "concept",
      "detail": "メルカリで1分で購入できた、希少なスケルトンモデルのポメラ。",
      "sentiment": 1.0,
      "community": 1,
      "first_seen": "2026-02-15T18:28:14.833720",
      "last_seen": "2026-02-15T18:28:14.833720",
      "weight": 1
    },
    {
      "id": "event:lalaport_trip",
      "label": "ららぽーとお出かけ",
      "type": "event",
      "detail": "家族3人とさやかの両親との買い物。蒼馬の用品を購入した。",
      "sentiment": 0.7,
      "status": "Completed",
      "community": 2,
      "first_seen": "2026-02-15T18:28:14.833722",
      "last_seen": "2026-02-15T18:28:14.833722",
      "weight": 1
    },
    {
      "id": "person:sayaka",
      "label": "さやか",
      "type": "person",
      "detail": "妻。33歳。",
      "community": 2,
      "first_seen": "2026-02-15T18:28:14.833722",
      "last_seen": "2026-02-16T00:39:23.912766",
      "weight": 4,
      "tags": []
    },
    {
      "id": "person:souma",
      "label": "蒼馬",
      "type": "person",
      "detail": "息子。0歳（5月9日生まれ）。現在9ヶ月。",
      "community": 2,
      "first_seen": "2026-02-15T18:28:14.833724",
      "last_seen": "2026-02-16T00:39:23.912753",
      "weight": 4,
      "tags": []
    },
    {
      "id": "person:sayaka_parents",
      "label": "さやかの両親",
      "type": "person",
      "detail": "一緒にららぽーとで買い物をした親族。",
      "community": 2,
      "first_seen": "2026-02-15T18:28:14.833725",
      "last_seen": "2026-02-15T18:28:14.833725",
      "weight": 1
    },
    {
      "id": "place:gatten_sushi",
      "label": "がってん寿司",
      "type": "place",
      "detail": "鯛の塩炙りが絶品だった寿司店。",
      "sentiment": 0.9,
      "community": 2,
      "first_seen": "2026-02-15T18:28:14.833726",
      "last_seen": "2026-02-15T18:28:14.833726",
      "weight": 1
    },
    {
      "id": "goal:diet",
      "label": "ダイエット",
      "type": "goal",
      "detail": "現在取り組んでいるが、寿司やチュロスを食べてしまった。",
      "sentiment": -0.2,
      "status": "Active",
      "tags": [
        "Cognitive Distortion: Should Statement"
      ],
      "community": 2,
      "first_seen": "2026-02-15T18:28:14.833727",
      "last_seen": "2026-02-15T18:28:14.833727",
      "weight": 1
    },
    {
      "id": "project:llm_analysis",
      "label": "LLM自己分析フローの構築",
      "type": "project",
      "detail": "日記をLLMに読み込ませて自己分析を行う仕組みの検討。",
      "status": "Active",
      "community": 3,
      "first_seen": "2026-02-15T18:28:14.833728",
      "last_seen": "2026-02-15T18:28:14.833728",
      "weight": 1
    },
    {
      "id": "concept:json_ld",
      "label": "JSON-LD",
      "type": "concept",
      "detail": "LLMとの認識のズレをなくすための構造化データフォーマット。",
      "sentiment": 0.6,
      "community": 3,
      "first_seen": "2026-02-15T18:28:14.833729",
      "last_seen": "2026-02-15T18:28:14.833729",
      "weight": 1
    },
    {
      "id": "insight:freeform_writing",
      "label": "自由形式へのこだわり",
      "type": "insight",
      "detail": "思考を遮らない自由な記述と、LLM用の構造化をどう両立するかという悩み。",
      "sentiment": 0.0,
      "tags": [
        "Conflict"
      ],
      "community": 3,
      "first_seen": "2026-02-15T18:28:14.833730",
      "last_seen": "2026-02-15T18:28:14.833730",
      "weight": 1
    },
    {
      "id": "insight:past_pomera_failure",
      "label": "過去のポメラ挫折経験",
      "type": "insight",
      "detail": "DM100、DM30、DM200を使いこなせず売却した過去。",
      "sentiment": -0.3,
      "tags": [
        "Past Failure"
      ],
      "community": 1,
      "first_seen": "2026-02-15T18:28:14.833730",
      "last_seen": "2026-02-15T18:28:14.833730",
      "weight": 1
    },
    {
      "id": "emotion:writing_joy",
      "label": "日記を書く達成感",
      "type": "emotion",
      "detail": "頭のモヤモヤが晴れ、自分と向き合えている感覚。",
      "sentiment": 1.0,
      "tags": [
        "Growth",
        "Mental Health"
      ],
      "community": 0,
      "first_seen": "2026-02-15T18:28:14.833731",
      "last_seen": "2026-02-15T18:28:14.833731",
      "weight": 1
    },
    {
      "id": "goal:effective_pomera_use",
      "label": "ポメラの有効活用",
      "type": "goal",
      "detail": "今回は挫折せず、ポメラを自己成長に繋げたい。",
      "status": "Active",
      "community": 1,
      "first_seen": "2026-02-15T18:28:14.833732",
      "last_seen": "2026-02-15T18:28:14.833732",
      "weight": 1
    },
    {
      "id": "diary:2026-02-14",
      "label": "2026-02-14",
      "type": "diary",
      "detail": "日記エントリ",
      "tags": [],
      "sentiment": 0.0,
      "date": "2026-02-14",
      "analysis_content": "プロフェッショナルなライフコーチおよびデータアナリストとして、2026年2月14日の日記データを分析し、フィードバックとアクションプランを提示します。\n\n---\n\n# デイリーフィードバック＆アクションプラン：2026-02-14\n\n## 1. Plan vs Actual Analysis（計画と実績の分析）\n\n本日はマスターグラフに事前の予定が登録されていなかったため、今日の実績から現在のステータスを評価します。\n\n*   **完了したイベント**:\n    *   **ららぽーとへのお出かけ**: 家族や親族との交流、蒼馬さんの用品購入など、対人・家族面で非常に充実した時間を過ごせています（Sentiment 0.7）。\n*   **未達・課題のある目標**:\n    *   **ダイエット (Status: Active)**: 「がってん寿司」での食事やチュロスにより、目標に反する行動が発生しました。グラフ内の「べき思考（Should Statement）」というタグから、**「せっかくの外出だから楽しむべき」という誘惑と「節制すべき」という自責の板挟み**が伺えます。\n*   **進行中のプロジェクト**:\n    *   **LLM自己分析フローの構築**: JSON-LDの検討など、技術的な具体化が進んでいます。\n    *   **ポメラの有効活用**: 過去に3台の挫折経験がある中、明日の新型（スケルトンモデル）到着に向けて期待と緊張が混在しています。\n\n## 2. Meta-Cognition（メタ認知：思考のパターンとトリガー）\n\nデータから以下のパターンが特定されました：\n\n*   **「道具」への高い期待と過去のトラウマ**:\n    新しい道具（スケルトンポメラ）の購入に対する高揚感（Sentiment 1.0）がある一方で、過去の挫折（DM100/30/200）を明確に記憶しています。**「手に入れること」が目的化しやすい傾向**があることを自覚している点は、成長に向けた重要な一歩です。\n*   **「自由」と「構造」の葛藤**:\n    思考を妨げたくない「自由記述」へのこだわりと、LLMに理解させたい「構造化（JSON-LD）」の間でトレードオフが発生しています。これはあなたの知的好奇心と効率性の両立を求める性質を表しています。\n*   **食のトリガー**:\n    「がってん寿司の鯛の塩炙り」のように、**質の高い食体験に対してはダイエットの優先順位が下がりやすい**ようです。これを単なる「失敗」と捉えず、「特別な日の例外」として許容できるかが継続の鍵です。\n\n## 3. Context-Aware Advice（コンテキストに基づく助言）\n\n### **Keep：今後も継続すべきこと**\n*   **「書くこと」によるメンタルケア**: 「頭のモヤモヤが晴れる」という感覚（Sentiment 1.0）を大切にしてください。ポメラが届く前から、今の執筆フロー自体がすでにあなたの精神的安定に寄与しています。\n*   **家族との共有体験**: 良好な対人関係はすべての活動の基盤です。\n\n### **Problem：進捗を阻害している要因**\n*   **「べき思考」による自己否定**: ダイエット中の外食を「失敗」と定義しすぎると、モチベーションの減退を招きます。\n*   **ポメラの「所有」による満足**: 過去の挫折パターンは「買ったことで満足し、実運用が形骸化する」ことだった可能性があります。\n\n### **Try：明日への具体的なアクション**\n1.  **【明日：ポメラ到着イベント】への備え**:\n    *   明日は「設定」や「カスタマイズ」に時間を使いすぎず、まずは**「今の気持ちを10分だけ打つ」というスモールスタート**を徹底してください。\n    *   過去の機種で挫折した理由（例：重さ、起動速度、同期の面倒さなど）を、新しいスケルトンモデルでどう回避するか、ポメラ自身を使って「ポメラ会議」を自分と開催してみてください。\n2.  **【ダイエット】のリカバリー**:\n    *   明日は「ららぽーと」での摂取カロリーを相殺するため、軽めの食事、または15分程度のウォーキングを意識的に取り入れてください。\n3.  **【LLM構築】への一歩**:\n    *   「自由形式」と「構造化」を分けるアプローチを検討してください。まず自由に書き、その後にLLMを使って「抽出（JSON化）」させるという**後処理フロー**に振り切ることで、執筆時のストレスが軽減されます。\n\n---\n**コーチの一言**:\nスケルトンモデルのポメラ、楽しみですね！「過去の自分」に縛られず、「今の自分がどう書きたいか」を優先して、明日の到着を迎えましょう。",
      "first_seen": "2026-02-15T18:28:14.833733",
      "last_seen": "2026-02-15T18:28:14.833733",
      "weight": 1
    },
    {
      "id": "concept:pomera",
      "label": "ポメラ (DM250XG)",
      "type": "concept",
      "detail": "届いたばかりの黄色のスケルトンモデル。所有欲を満たしてくれる執筆専用デバイス。",
      "sentiment": 0.9,
      "tags": [
        "Growth"
      ],
      "community": 1,
      "first_seen": "2026-02-15T18:28:40.946187",
      "last_seen": "2026-02-15T18:28:40.946187",
      "weight": 1
    },
    {
      "id": "project:self_analysis_flow",
      "label": "自己分析フローの構築",
      "type": "project",
      "detail": "ポメラで何をするべきか、責務を明確にするためのプロセス設計。",
      "status": "Active",
      "sentiment": 0.3,
      "community": 2,
      "first_seen": "2026-02-15T18:28:40.946189",
      "last_seen": "2026-02-15T18:28:40.946189",
      "weight": 1
    },
    {
      "id": "emotion:excitement",
      "label": "興奮と満足感",
      "type": "emotion",
      "detail": "ポメラを手にした瞬間の「買ってよかった」という強い喜び。",
      "sentiment": 1.0,
      "community": 1,
      "first_seen": "2026-02-15T18:28:40.946190",
      "last_seen": "2026-02-15T18:28:40.946190",
      "weight": 1
    },
    {
      "id": "goal:sustainable_use",
      "label": "ポメラの継続的利用",
      "type": "goal",
      "detail": "以前のように使わなくなることを防ぎ、活用し続けること。",
      "status": "Active",
      "tags": [
        "Growth"
      ],
      "community": 2,
      "first_seen": "2026-02-15T18:28:40.946192",
      "last_seen": "2026-02-15T18:28:40.946192",
      "weight": 1
    },
    {
      "id": "insight:cognitive_load_risk",
      "label": "運用負荷による忌避のリスク",
      "type": "insight",
      "detail": "責務が不明確で負荷が重くなると、デバイスに触れなくなる可能性があるという気づき。",
      "sentiment": -0.4,
      "tags": [
        "Cognitive Distortion: Fortune Telling"
      ],
      "community": 2,
      "first_seen": "2026-02-15T18:28:40.946193",
      "last_seen": "2026-02-15T18:28:40.946193",
      "weight": 1
    },
    {
      "id": "event:past_blog_failure",
      "label": "過去のブログ執筆の挫折",
      "type": "event",
      "detail": "ブログを書く行為を重く感じ、ポメラを使わなくなってしまった過去の経験。",
      "status": "Completed",
      "sentiment": -0.6,
      "community": 2,
      "first_seen": "2026-02-15T18:28:40.946194",
      "last_seen": "2026-02-15T18:28:40.946194",
      "weight": 1
    },
    {
      "id": "diary:2026-02-15",
      "label": "2026年2月15日の日記",
      "type": "diary",
      "detail": "掃除の悩みと減量の進捗についての記録",
      "tags": [],
      "sentiment": 0.0,
      "date": "2026-02-15",
      "analysis_content": "ライフコーチ兼データアナリストとして、本日の記録（2026-02-15）とマスターコンテキストを統合し、分析とアクションプランを提示します。\n\n---\n\n# デイリーフィードバック＆アクションプラン：2026年2月15日\n\n## 1. Plan vs Actual Analysis（計画と実績の分析）\n\n*   **スケジュール達成度:**\n    *   **ポメラの到着（Scheduled）:** **達成。** メルカリで購入した「ポメラ DM250XG」が無事に手元に届き、所有欲が満たされている状態です（感情スコア 0.9）。予定通りのイベント発生により、ポジティブなエネルギーが生まれています。\n*   **目標への進捗:**\n    *   **ポメラの有効活用:** **順調な滑り出し。** 単に「使う」だけでなく、「自己分析フローの構築」というプロジェクトを即座に立ち上げ、過去の失敗（ブログ執筆の挫折）を繰り返さないための「仕組み化」に着手できています。\n    *   **ダイエット（Active Goal）:** **本日の言及なし。** 新しいガジェットへの興奮により、意識が「執筆・分析」に偏っています。過去のデータでは「寿司やチュロス」による脱線があったため、高揚感に伴う「お祝い食」などの誘惑に注意が必要です。\n\n## 2. Meta-Cognition（メタ認知：思考パターンの分析）\n\n*   **「ツールへの依存」から「運用への関心」への進化:**\n    過去のあなたは「ツールを買って満足し、重いタスク（ブログ等）を課して自滅する」パターンがありました。しかし、今回は**「運用負荷による忌避のリスク」を事前に予見（Fortune Telling）**しており、メタ認知能力が向上しています。\n*   **ポジティブ・トリガー:** \n    「限定品」「スケルトン」「新しいデバイス」といった視覚的・所有的な刺激が、あなたの活動エネルギーを最大化（感情スコア 1.0）させる強力なトリガーとなっています。\n*   **ネガティブ・トリガー:**\n    「責務の不明確さ」が不安（感情スコア 0.3）を生んでいます。これは、完璧主義的な傾向が「何をすべきか完璧に決めなければならない」というプレッシャーを生んでいる可能性を示唆しています。\n\n## 3. Context-Aware Advice（状況に合わせたアドバイス）\n\n### **Keep（継続すべきこと）**\n*   **「仕組み」からの着手:** ポメラを使い始める前に「自己分析フロー」を定義しようとする姿勢は素晴らしいです。デバイスを「魔法の杖」にせず、あくまで「筆記具」として位置づけようとする試みを続けてください。\n\n### **Problem（進捗を妨げている要因）**\n*   **認知負荷の過大評価:** 「自己分析を深めなければならない」という思いが強すぎると、ポメラを開くこと自体が「仕事」になってしまいます。過去のブログの挫折と同様、**「立派なアウトプットを出さなければならない」という心理的障壁**が再燃する兆しがあります。\n\n### **Try（明日への具体的な提案）**\n1.  **「5分間・無目的ブラインドタッチ」の実施:** \n    明日は「自己分析」という重いテーマを一度脇に置き、ただポメラの打鍵感を楽しむためだけに5分間、頭に浮かんだことを書き殴る（ジャーナリング）時間を設けてください。\n2.  **ダイエットとの接続:**\n    ポメラの機動性を活かし、食事の前に「今からこれを食べるが、体調にどう影響するか？」を一行だけポメラにメモしてください。新しいツールの興奮をダイエットの記録習慣に転用しましょう。\n3.  **「運用フロー」の簡略化:**\n    明日中に「自己分析フロー」を完成させる必要はありません。「ポメラを開く→日付を書く」という最小単位の動作を「成功」と定義し、運用のハードルを意識的に下げてください。\n\n---\n**コーチの一言:** \n新しい相棒（ポメラ）との出会い、おめでとうございます。その「黄色いスケルトン」が、あなたの思考を透明にし、未来を書き換えるツールになることを期待しています。まずは「完璧な活用法」を捨てることから始めましょう。",
      "first_seen": "2026-02-15T18:28:40.946195",
      "last_seen": "2026-02-15T12:07:30.299679",
      "weight": 1
    },
    {
      "id": "review:weekly:2026-02-15",
      "label": "週次レビュー (2026-02-15)",
      "type": "review",
      "detail": "LLMによる週次振り返りと次週の提案",
      "analysis_content": "熟練したライフコーチ兼データアナリストとして、あなたの過去1週間のデータを統合・分析し、自己成長のための「週次レビュー」を提示します。\n\n---\n\n# 週次レビュー: 2026-02-09 - 2026-02-15\n\n## 1. 📈 ハイライトとトレンド\n\n- **感情の推移**: \n  週の後半にかけて「期待」から「興奮・満足感」へと大きくポジティブなシフトが見られました。特に、希少なスケルトンポメラの購入（14日）から到着（15日）にかけて、デバイスへの所有欲が満たされると同時に、執筆活動への意欲が最高潮に達しています。一方で、ダイエットに関しては週末のイベント（外食）により、やや自己規律が揺らぎ、わずかな葛藤が見られる局面もありました。\n  \n- **主要イベント**: \n  1. **スケルトンポメラ (DM250XG) の入手**: メルカリでの即断即決から実機の到着まで、今週の最もポジティブなトリガーとなりました。\n  2. **ららぽーとでの家族時間**: 蒼馬（お子様）の用品購入や、家族・義父母との交流。社交的で充実した時間。\n  3. **LLM自己分析フローの概念構築**: 自由な執筆と構造化データ（JSON-LD）をどう組み合わせるかという、知的探求の開始。\n\n- **最大の成果 (Big Wins)**: \n  **「自分に最適な執筆環境の再定義」**です。過去に3度挫折したポメラというデバイスに対し、今回は「LLMによる自己分析」という明確な出口戦略を持って再挑戦を始めたことは、単なるガジェット購入以上の価値があります。\n\n## 2. 🎯 ゴール進捗分析\n\n- **現在のアクティブな戦略と結果**:\n  「日記による自己分析の自動化」というプロジェクトが始動しました。JSON-LDを用いた構造化データの検討など、技術的かつ論理的なアプローチが取られています。\n  \n- **特定されたブロッカー**:\n  - **運用の重さ（心理的ハードル）**: 過去に「ブログ執筆」という重い責務を課したことでポメラを挫折した経験。今回も「完璧に構造化しなくては」という思いが強すぎると、同様の挫折を招くリスクがあります。\n  - **自己管理の緩み**: 外食時の誘惑（がってん寿司、チュロス）に対し、ダイエット目標が後回しになる傾向。\n\n- **特定されたブースター**:\n  - **所有感と没入感**: 限定モデルのポメラを使うこと自体が、執筆の動機付け（やる気スイッチ）として強力に機能しています。\n  - **「頭のモヤモヤの解消」体験**: 日記を書くことで得られる精神的報酬が、習慣化の強い動機になっています。\n\n## 3. 💡 インサイトとパターン認識\n\n- **「自由」と「規律」のジレンマ**: \n  あなたは「思考を遮らない自由な記述」を好む一方で、LLMに正しく理解させるための「構造化」も重視しています。この両立が、現在のあなたの創造性の源泉であり、同時にストレスの種でもあります。\n  \n- **ポメラの歴史的パターン**: \n  過去に3モデルを手放した理由は、デバイスの問題ではなく「ポメラに課したタスクの重さ」にありました。「ポメラ＝アウトプット（ブログ）の場」ではなく、**「ポメラ＝思考の整理（自分との対話）の場」**と定義し直している現在の方向性は、非常に理にかなっています。\n\n- **認知の歪み（すべき思考）**:\n  「ダイエット中だからこれを食べてはいけない」という強い制約が、逆に食べた後の罪悪感を生んでいる可能性があります。イベント時の食事を「失敗」ではなく「計画的な休息」と捉えるリフレーミングが有効かもしれません。\n\n## 4. 🚀 来週の戦略 (Future Action)\n\n- **次週のフォーカスエリア**:\n  1. **「ポメラの責務」の固定化**: 来週は「清書」や「公開」を一切考えず、単なる「思考のダンプ（吐き出し）」に特化して使い、心理的ハードルを極限まで下げてください。\n  2. **LLMプロンプトの最小化**: JSON-LDの厳密さにこだわりすぎず、まずは「箇条書き」レベルの緩いルールでLLMに読み込ませ、運用の継続性を優先してください。\n  3. **食事のリカバリー戦略**: 週末の過剰摂取を調整するため、平日のタンパク質摂取と水分補給にフォーカスした食事管理を再設定してください。\n\n- **行動変容の提案**: \n  **「朝イチ5分のポメラ・セッション」**\n  夜の振り返りだけでなく、朝起きてすぐ、ポメラを開いて「今の気分」や「今日やりたいこと」を100文字程度打つだけのルーチンを取り入れてください。デバイスに触れること自体の「摩擦」をゼロにします。\n\n---\n\n**コーチのコメント**: \n新しいデバイスを手に、自分の思考をシステム化しようとする姿勢は素晴らしいです。過去の挫折を「データ」として捉え、今回の運用に活かそうとするメタ認知能力が高まっています。来週は「継続こそが最大の分析データになる」という意識で、気楽に取り組んでいきましょう。",
      "date": "2026-02-15",
      "sentiment": 0.0,
      "community": 10,
      "first_seen": "2026-02-15T18:43:40.656142",
      "last_seen": "2026-02-15T19:02:29.908030",
      "weight": 10,
      "tags": []
    },
    {
      "id": "event:pet_room_cleaning",
      "label": "ペット部屋の掃除",
      "type": "event",
      "detail": "フローリングの粘着部分を剥がし、部屋をきれいに保つ作業。",
      "status": "Scheduled",
      "date": "2026-02-15",
      "sentiment": -0.2,
      "community": 1,
      "first_seen": "2026-02-15T19:44:17.435345",
      "last_seen": "2026-02-16T00:26:33.487751",
      "weight": 14,
      "tags": []
    },
    {
      "id": "goal:clean_pet_room_habit",
      "label": "ペット部屋をきれいに保つ",
      "type": "goal",
      "status": "Active",
      "detail": "毎日の掃除をマストと捉えているが、実行が難しいと感じている",
      "tags": [
        "Cognitive Distortion: Should Statements",
        "Habit"
      ],
      "community": 1,
      "first_seen": "2026-02-15T19:44:17.435346",
      "last_seen": "2026-02-15T12:07:30.299689",
      "weight": 13
    },
    {
      "id": "insight:sticky_residue_problem",
      "label": "粘着部分が剥がれない悩み",
      "type": "insight",
      "detail": "爪とぎカバーの粘着部分がフローリングに残っている。",
      "sentiment": -0.4,
      "community": 1,
      "first_seen": "2026-02-15T19:44:17.435347",
      "last_seen": "2026-02-16T00:39:23.912646",
      "weight": 14,
      "tags": []
    },
    {
      "id": "barrier:time_poverty",
      "label": "時間の不足",
      "type": "concept",
      "detail": "仕事の掛け持ちと育児により、掃除の習慣化に必要な時間が確保できない",
      "tags": [
        "Conflict"
      ],
      "community": 1,
      "first_seen": "2026-02-15T19:44:17.435348",
      "last_seen": "2026-02-15T12:07:30.299698",
      "weight": 13
    },
    {
      "id": "goal:weight_loss_75kg",
      "label": "体重75kg切り",
      "type": "goal",
      "status": "Active",
      "detail": "今年の目標。現在は80.5kg前後。一時は92kgあった。",
      "sentiment": 0.3,
      "tags": [
        "Growth",
        "Health",
        "ダイエット",
        "健康"
      ],
      "community": 2,
      "first_seen": "2026-02-15T19:44:17.435349",
      "last_seen": "2026-02-16T00:39:23.912656",
      "weight": 16
    },
    {
      "id": "insight:weight_plateau",
      "label": "ダイエットの停滞期",
      "type": "insight",
      "detail": "12kg減量後、ここ2週間ほど体重が停滞している。",
      "sentiment": -0.1,
      "community": 2,
      "first_seen": "2026-02-15T19:44:17.435350",
      "last_seen": "2026-02-16T00:26:33.487767",
      "weight": 14,
      "tags": []
    },
    {
      "id": "concept:cheat_day",
      "label": "週一のチートデイ",
      "type": "concept",
      "detail": "飢餓状態を防ぐために普通の量を食べる日を設ける。",
      "community": 2,
      "first_seen": "2026-02-15T19:44:17.435350",
      "last_seen": "2026-02-16T00:39:23.912675",
      "weight": 16,
      "tags": [],
      "sentiment": 0.2
    },
    {
      "id": "concept:dietary_restriction",
      "label": "食事制限戦略",
      "type": "concept",
      "detail": "1日1食（1200kcal程度）を基本とする減量法",
      "community": 2,
      "first_seen": "2026-02-15T19:44:17.435351",
      "last_seen": "2026-02-15T12:07:30.299711",
      "weight": 13,
      "tags": []
    },
    {
      "id": "insight:sticky_residue",
      "label": "粘着部分が剥がせない悩み",
      "type": "insight",
      "detail": "フローリングに貼った爪とぎカバーの粘着が残ってしまった問題。",
      "sentiment": -0.5,
      "community": 1,
      "first_seen": "2026-02-16T00:26:33.487757",
      "last_seen": "2026-02-16T00:26:33.487757",
      "weight": 1
    },
    {
      "id": "goal:cleaning_habit",
      "label": "掃除の習慣化",
      "type": "goal",
      "detail": "毎日掃除をすること。多忙により時間が作れない現状がある。",
      "status": "Active",
      "tags": [
        "Barrier: Time Management"
      ],
      "community": 1,
      "first_seen": "2026-02-16T00:26:33.487758",
      "last_seen": "2026-02-16T00:26:33.487758",
      "weight": 1
    },
    {
      "id": "project:pomera_workflow",
      "label": "ポメラ×AIナレッジグラフ自動化",
      "type": "project",
      "detail": "ポメラからGmail経由でGitHub Actionsを回し、Geminiで分析してKGへ反映する仕組み。",
      "status": "Active",
      "sentiment": 0.9,
      "community": 3,
      "first_seen": "2026-02-16T00:26:33.487770",
      "last_seen": "2026-02-16T00:30:31.747202",
      "weight": 2,
      "tags": []
    },
    {
      "id": "emotion:workflow_fun",
      "label": "ワークフロー構築の楽しさ",
      "type": "emotion",
      "detail": "仕組みを考えることに喜びを感じている。",
      "sentiment": 0.9,
      "community": 3,
      "first_seen": "2026-02-16T00:26:33.487771",
      "last_seen": "2026-02-16T00:39:23.912701",
      "weight": 3,
      "tags": []
    },
    {
      "id": "insight:youtube_restriction",
      "label": "YouTube視聴制限の必要性",
      "type": "insight",
      "detail": "ポメラ関連の動画を夜更かしして見てしまう癖を自制したい。",
      "sentiment": -0.3,
      "tags": [
        "Self-Regulation",
        "習慣改善"
      ],
      "community": 3,
      "first_seen": "2026-02-16T00:26:33.487773",
      "last_seen": "2026-02-16T00:39:23.912736",
      "weight": 2
    },
    {
      "id": "project:monster_design",
      "label": "モンスターデザインの習作",
      "type": "project",
      "detail": "趣味で毎日モンスターを描いている。Draw Sessionsを目標にしている。",
      "sentiment": -0.2,
      "tags": [
        "Cognitive Distortion: Labeling"
      ],
      "community": 4,
      "first_seen": "2026-02-16T00:26:33.487774",
      "last_seen": "2026-02-16T00:26:33.487774",
      "weight": 1
    },
    {
      "id": "goal:realistic_monster_design",
      "label": "リアリティのあるモンスターデザイン",
      "type": "goal",
      "detail": "Draw Sessionsのような絵を描きたい。自分の現状には納得していない。",
      "status": "Active",
      "community": 4,
      "first_seen": "2026-02-16T00:26:33.487775",
      "last_seen": "2026-02-16T00:39:23.912743",
      "weight": 3,
      "sentiment": -0.1,
      "tags": [
        "Self-Reflection",
        "Skill Up",
        "イラスト",
        "趣味"
      ]
    },
    {
      "id": "person:mugi",
      "label": "むぎ",
      "type": "person",
      "detail": "ボストンテリア。一昨年の10月から飼っている家族。",
      "community": 5,
      "first_seen": "2026-02-16T00:26:33.487776",
      "last_seen": "2026-02-16T00:39:23.912749",
      "weight": 3,
      "tags": []
    },
    {
      "id": "event:shiroyama_park_walk",
      "label": "城山公園での散歩",
      "type": "event",
      "detail": "家族3人での外出。初めて息子とシーソーをした。",
      "status": "Completed",
      "date": "2026-02-15",
      "sentiment": 0.8,
      "community": 5,
      "first_seen": "2026-02-16T00:26:33.487785",
      "last_seen": "2026-02-16T00:39:23.912784",
      "weight": 2,
      "tags": []
    },
    {
      "id": "event:choking_incident",
      "label": "蒼馬の喉つまり事件",
      "type": "event",
      "detail": "初めてのクッキーを喉に詰まらせ、背部叩打法で救出。危うく救急事態だった。",
      "status": "Completed",
      "date": "2026-02-15",
      "sentiment": -1.0,
      "tags": [
        "Cognitive Distortion: Labeling",
        "Crisis"
      ],
      "community": 5,
      "first_seen": "2026-02-16T00:26:33.487786",
      "last_seen": "2026-02-16T00:26:33.487786",
      "weight": 1
    },
    {
      "id": "insight:parental_regret",
      "label": "親としての失格感",
      "type": "insight",
      "detail": "ながら作業で菓子を与えた危機管理不足への猛省。",
      "sentiment": -0.9,
      "tags": [
        "Cognitive Distortion: Labeling"
      ],
      "community": 5,
      "first_seen": "2026-02-16T00:26:33.487787",
      "last_seen": "2026-02-16T00:26:33.487787",
      "weight": 1
    },
    {
      "id": "concept:github_actions_workflow",
      "label": "GitHub Actionsによる自動化",
      "type": "concept",
      "detail": "Gmail取得を定期実行しGemini 3.0 Flashで分析する構成案。",
      "community": 3,
      "first_seen": "2026-02-16T00:26:33.487788",
      "last_seen": "2026-02-16T00:26:33.487788",
      "weight": 1
    },
    {
      "id": "goal:pomera_book",
      "label": "ポメラ活用案の出版",
      "type": "goal",
      "detail": "構築したワークフローを本として形にしたい。",
      "status": "Active",
      "sentiment": 0.7,
      "community": 3,
      "first_seen": "2026-02-16T00:26:33.487790",
      "last_seen": "2026-02-16T00:39:23.912818",
      "weight": 2,
      "tags": []
    },
    {
      "id": "diary:2026-02-16",
      "label": "2026-02-16の日記",
      "type": "diary",
      "date": "2026-02-16",
      "detail": "今日の日記エントリ",
      "first_seen": "2026-02-16T00:26:33.487791",
      "last_seen": "2026-02-16T00:39:23.912826",
      "weight": 1,
      "tags": [],
      "analysis_content": "昨日は、ご家族での穏やかな時間から一転して、肝を冷やすような出来事がありましたね。城山公園で息子さんと初めてシーソーを楽しんだ喜びが、一瞬の不注意による恐怖で塗りつぶされてしまったこと、その心中をお察しします。\n\nあなたは今、ご自身のことを「親失格」という非常に重い言葉で定義しようとしていますが、そこには少し立ち止まって目を向けるべき心の動きがあります。私たちは、たった一つの過ちや予期せぬトラブルが起きると、それまでの自分の努力や愛情のすべてを否定してしまいがちです。しかし、実際に起きたことを見てみれば、あなたは即座に背部叩打法を実践し、最悪の事態から息子さんを救い出しました。その瞬間の判断力と行動力こそが、親としての責任感の現れに他なりません。完璧な親であろうとするあまり、一度の綻びを全人格的な否定に結びつけてしまうのは、あなた自身の優しさゆえの苦しみでもありますが、それは事実をありのままに見ることを妨げてしまいます。\n\nこの「完璧でありたい」という願いは、他の場面でも顔をのぞかせているようです。ペット部屋の掃除において、フローリングに残った粘着剤がなかなか剥がれないことにストレスを感じているのも、あるいはダイエットにおいて「一食1200kcal」という厳しい枠を自分に課しているのも、理想の自分へ近づこうとする強い意志の表れでしょう。ただ、仕事、育児、そして自己研鑽と、多くの役割を完璧にこなそうとすれば、どうしても注意力の資源は分散してしまいます。今日のような事故は、あなたが怠慢だったからではなく、あまりに多くのものを背負い、全力を尽くしすぎている中で生じた、不可避な揺らぎだったのかもしれません。\n\nポメラのワークフロー構築に感じている純粋な喜びは、あなたの創造性を支える大切なエネルギーです。仕組みを整えることに没頭できる時間は、あなたにとっての「聖域」のようなものでしょう。ただ、その没頭が夜更かしやYouTube視聴へと流れ込み、翌日の余裕を奪ってしまうというパターンが過去にも見られました。構築した素晴らしいシステムを活かすためにも、自分を追い込みすぎない「余白」を意識的に作ることが、今のあなたには必要なようです。\n\n明日は、今日感じた自責の念を少しだけ横に置いて、まずはご自身を労わってあげてください。粘着剤が一度に綺麗に剥がれないように、人の心も一度の反省ですべてが解決するわけではありません。まずは、今日無事に家族で過ごせているという事実に感謝し、1分でも2分でも、何も生産的なことを考えずに深呼吸する時間を設けてみてはいかがでしょうか。その小さな余白が、また明日からのあなたを支える力になるはずです。"
    },
    {
      "id": "place:shiroyama_park",
      "label": "城山公園",
      "type": "place",
      "detail": "家族で散歩に行った大きな公園。ピクニックの候補地。",
      "sentiment": 0.8,
      "community": 1,
      "first_seen": "2026-02-16T00:30:31.747184",
      "last_seen": "2026-02-16T00:30:31.747184",
      "weight": 1
    },
    {
      "id": "goal:clean_pet_room",
      "label": "ペット部屋の清掃と維持",
      "type": "goal",
      "status": "Active",
      "detail": "床の粘着部分を剥がし、毎日掃除する習慣を身につける。",
      "sentiment": -0.2,
      "tags": [
        "Barrier: Lack of time"
      ],
      "community": 1,
      "first_seen": "2026-02-16T00:30:31.747186",
      "last_seen": "2026-02-16T00:30:31.747186",
      "weight": 1
    },
    {
      "id": "event:choking_accident",
      "label": "息子の誤嚥危機",
      "type": "event",
      "status": "Completed",
      "date": "2026-02-15",
      "detail": "初めてのクッキーを喉に詰まらせた事件。背部叩打法で回避。",
      "sentiment": -1.0,
      "tags": [
        "Cognitive Distortion: Labeling",
        "Crisis"
      ],
      "community": 1,
      "first_seen": "2026-02-16T00:30:31.747208",
      "last_seen": "2026-02-16T00:30:31.747208",
      "weight": 1
    },
    {
      "id": "insight:gh_actions_limitation",
      "label": "GitHub Actionsのスケジュール制約",
      "type": "insight",
      "detail": "定期実行の時間を厳密にスケジューリングするのが難しいという技術的懸念。",
      "sentiment": -0.2,
      "community": 3,
      "first_seen": "2026-02-16T00:30:31.747209",
      "last_seen": "2026-02-16T00:30:31.747209",
      "weight": 1
    },
    {
      "id": "goal:publish_book",
      "label": "ポメラ活用術の書籍化",
      "type": "goal",
      "status": "Active",
      "detail": "構築したワークフローや活用案を本としてまとめたい。",
      "sentiment": 0.7,
      "community": 3,
      "first_seen": "2026-02-16T00:30:31.747210",
      "last_seen": "2026-02-16T00:30:31.747210",
      "weight": 1
    },
    {
      "id": "event:cleaning_pet_room",
      "label": "ペット部屋の掃除",
      "type": "event",
      "detail": "粘着剤の除去と全体の清掃。時間の確保が課題。",
      "status": "Completed",
      "sentiment": -0.2,
      "tags": [
        "家事",
        "時間管理"
      ],
      "community": 1,
      "first_seen": "2026-02-16T00:39:23.912639",
      "last_seen": "2026-02-16T00:39:23.912639",
      "weight": 1
    },
    {
      "id": "goal:daily_cleaning",
      "label": "毎日の掃除の習慣化",
      "type": "goal",
      "detail": "ペット部屋をきれいに保つための目標。",
      "status": "Active",
      "tags": [
        "習慣化"
      ],
      "community": 1,
      "first_seen": "2026-02-16T00:39:23.912643",
      "last_seen": "2026-02-16T00:39:23.912643",
      "weight": 1
    },
    {
      "id": "project:pomera_ai_workflow",
      "label": "ポメラAIワークフロー構築",
      "type": "project",
      "detail": "ポメラからGmail経由で自動的にナレッジグラフへ反映する仕組み。",
      "status": "Active",
      "tags": [
        "技術開発",
        "GitHub Actions",
        "Gemini"
      ],
      "community": 3,
      "first_seen": "2026-02-16T00:39:23.912680",
      "last_seen": "2026-02-16T00:39:23.912680",
      "weight": 1
    },
    {
      "id": "event:souma_choking_incident",
      "label": "蒼馬の喉詰まり事件",
      "type": "event",
      "detail": "初めてのクッキーを喉に詰まらせ、背部叩打法で救出。",
      "status": "Completed",
      "sentiment": -0.9,
      "tags": [
        "危機管理",
        "後悔",
        "Cognitive Distortion: Labeling"
      ],
      "community": 1,
      "first_seen": "2026-02-16T00:39:23.912800",
      "last_seen": "2026-02-16T00:39:23.912800",
      "weight": 1
    },
    {
      "id": "insight:parental_failure",
      "label": "親としての失格感",
      "type": "insight",
      "detail": "仕事中の不注意で息子を危険にさらしたことへの自責。",
      "sentiment": -1.0,
      "tags": [
        "Cognitive Distortion: All-or-Nothing",
        "Cognitive Distortion: Labeling"
      ],
      "community": 1,
      "first_seen": "2026-02-16T00:39:23.912814",
      "last_seen": "2026-02-16T00:39:23.912814",
      "weight": 1
    },
    {
      "id": "insight:github_actions_scheduling",
      "label": "GitHub Actionsの実行タイミング懸念",
      "type": "insight",
      "detail": "指定時間通りのスケジューリングが難しいという制約。",
      "sentiment": -0.2,
      "tags": [
        "技術的課題"
      ],
      "community": 3,
      "first_seen": "2026-02-16T00:39:23.912823",
      "last_seen": "2026-02-16T00:39:23.912823",
      "weight": 1
    }
  ],
  "edges": [
    {
      "source": "person:self",
      "target": "event:pomera_arrival",
      "type": "PLANS",
      "label": "到着を楽しみにしている",
      "first_seen": "2026-02-15T18:28:14.833735",
      "last_seen": "2026-02-15T18:28:14.833735",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "concept:skeleton_pomera",
      "type": "DISCOVERS",
      "label": "メルカリで見つけて購入した",
      "first_seen": "2026-02-15T18:28:14.833736",
      "last_seen": "2026-02-15T18:28:14.833736",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "event:lalaport_trip",
      "type": "PARTICIPATES",
      "label": "家族で行った",
      "first_seen": "2026-02-15T18:28:14.833737",
      "last_seen": "2026-02-15T18:28:14.833737",
      "weight": 1
    },
    {
      "source": "event:lalaport_trip",
      "target": "person:sayaka",
      "type": "ABOUT",
      "label": "さやかと同行",
      "first_seen": "2026-02-15T18:28:14.833738",
      "last_seen": "2026-02-15T18:28:14.833738",
      "weight": 1
    },
    {
      "source": "event:lalaport_trip",
      "target": "person:sayaka_parents",
      "type": "ABOUT",
      "label": "さやかの両親と合流",
      "first_seen": "2026-02-15T18:28:14.833739",
      "last_seen": "2026-02-15T18:28:14.833739",
      "weight": 1
    },
    {
      "source": "event:lalaport_trip",
      "target": "person:souma",
      "type": "ABOUT",
      "label": "蒼馬の用品を購入",
      "first_seen": "2026-02-15T18:28:14.833740",
      "last_seen": "2026-02-15T18:28:14.833740",
      "weight": 1
    },
    {
      "source": "event:lalaport_trip",
      "target": "place:gatten_sushi",
      "type": "AT",
      "label": "夕食を食べた",
      "first_seen": "2026-02-15T18:28:14.833741",
      "last_seen": "2026-02-15T18:28:14.833741",
      "weight": 1
    },
    {
      "source": "place:gatten_sushi",
      "target": "goal:diet",
      "type": "CONFLICTS_WITH",
      "label": "美味しすぎて食べ過ぎてしまった",
      "first_seen": "2026-02-15T18:28:14.833742",
      "last_seen": "2026-02-15T18:28:14.833742",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "project:llm_analysis",
      "type": "TARGETS",
      "label": "構築を目指している",
      "first_seen": "2026-02-15T18:28:14.833743",
      "last_seen": "2026-02-15T18:28:14.833743",
      "weight": 1
    },
    {
      "source": "project:llm_analysis",
      "target": "concept:json_ld",
      "type": "MENTIONS",
      "label": "フォーマットとして採用を検討",
      "first_seen": "2026-02-15T18:28:14.833744",
      "last_seen": "2026-02-15T18:28:14.833744",
      "weight": 1
    },
    {
      "source": "project:llm_analysis",
      "target": "insight:freeform_writing",
      "type": "BARRIER",
      "label": "記述の楽さと構造化の両立が課題",
      "first_seen": "2026-02-15T18:28:14.833745",
      "last_seen": "2026-02-15T18:28:14.833745",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "insight:past_pomera_failure",
      "type": "MENTIONS",
      "label": "過去の失敗を振り返る",
      "first_seen": "2026-02-15T18:28:14.833746",
      "last_seen": "2026-02-15T18:28:14.833746",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "goal:effective_pomera_use",
      "type": "TARGETS",
      "label": "今度こそ使いこなしたい",
      "first_seen": "2026-02-15T18:28:14.833747",
      "last_seen": "2026-02-15T18:28:14.833747",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "emotion:writing_joy",
      "type": "FEELING",
      "label": "書くことに達成感を感じている",
      "first_seen": "2026-02-15T18:28:14.833747",
      "last_seen": "2026-02-15T18:28:14.833747",
      "weight": 1
    },
    {
      "source": "emotion:writing_joy",
      "target": "person:self",
      "type": "CAUSAL",
      "label": "成長に繋がる実感を与えている",
      "first_seen": "2026-02-15T18:28:14.833748",
      "last_seen": "2026-02-15T18:28:14.833748",
      "weight": 1
    },
    {
      "source": "diary:2026-02-14",
      "target": "event:pomera_arrival",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:14.833749",
      "last_seen": "2026-02-15T18:28:14.833749"
    },
    {
      "source": "diary:2026-02-14",
      "target": "concept:skeleton_pomera",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:14.833750",
      "last_seen": "2026-02-15T18:28:14.833750"
    },
    {
      "source": "diary:2026-02-14",
      "target": "event:lalaport_trip",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:14.833751",
      "last_seen": "2026-02-15T18:28:14.833751"
    },
    {
      "source": "diary:2026-02-14",
      "target": "person:sayaka",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:14.833752",
      "last_seen": "2026-02-15T18:28:14.833752"
    },
    {
      "source": "diary:2026-02-14",
      "target": "person:souma",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:14.833753",
      "last_seen": "2026-02-15T18:28:14.833753"
    },
    {
      "source": "diary:2026-02-14",
      "target": "person:sayaka_parents",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:14.833754",
      "last_seen": "2026-02-15T18:28:14.833754"
    },
    {
      "source": "diary:2026-02-14",
      "target": "place:gatten_sushi",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:14.833754",
      "last_seen": "2026-02-15T18:28:14.833754"
    },
    {
      "source": "diary:2026-02-14",
      "target": "goal:diet",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:14.833755",
      "last_seen": "2026-02-15T18:28:14.833755"
    },
    {
      "source": "diary:2026-02-14",
      "target": "project:llm_analysis",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:14.833756",
      "last_seen": "2026-02-15T18:28:14.833756"
    },
    {
      "source": "diary:2026-02-14",
      "target": "concept:json_ld",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:14.833757",
      "last_seen": "2026-02-15T18:28:14.833757"
    },
    {
      "source": "diary:2026-02-14",
      "target": "insight:freeform_writing",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:14.833758",
      "last_seen": "2026-02-15T18:28:14.833758"
    },
    {
      "source": "diary:2026-02-14",
      "target": "insight:past_pomera_failure",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:14.833758",
      "last_seen": "2026-02-15T18:28:14.833758"
    },
    {
      "source": "diary:2026-02-14",
      "target": "emotion:writing_joy",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:14.833759",
      "last_seen": "2026-02-15T18:28:14.833759"
    },
    {
      "source": "diary:2026-02-14",
      "target": "goal:effective_pomera_use",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:14.833760",
      "last_seen": "2026-02-15T18:28:14.833760"
    },
    {
      "source": "person:self",
      "target": "concept:pomera",
      "type": "DISCOVERS",
      "label": "所有欲が満たされる",
      "first_seen": "2026-02-15T18:28:40.946204",
      "last_seen": "2026-02-15T18:28:40.946204",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "emotion:excitement",
      "type": "FEELING",
      "label": "買ってよかったと感じている",
      "first_seen": "2026-02-15T18:28:40.946206",
      "last_seen": "2026-02-15T18:28:40.946206",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "project:self_analysis_flow",
      "type": "TARGETS",
      "label": "今日中に固めたい",
      "first_seen": "2026-02-15T18:28:40.946207",
      "last_seen": "2026-02-15T18:28:40.946207",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "goal:sustainable_use",
      "type": "TARGETS",
      "label": "以前のようにならないよう気をつける",
      "first_seen": "2026-02-15T18:28:40.946208",
      "last_seen": "2026-02-15T18:28:40.946208",
      "weight": 1
    },
    {
      "source": "project:self_analysis_flow",
      "target": "concept:pomera",
      "type": "ABOUT",
      "label": "ポメラで行う作業内容を定義する",
      "first_seen": "2026-02-15T18:28:40.946209",
      "last_seen": "2026-02-15T18:28:40.946209",
      "weight": 1
    },
    {
      "source": "insight:cognitive_load_risk",
      "target": "goal:sustainable_use",
      "type": "BARRIER",
      "label": "負荷の増大が継続を阻害する",
      "first_seen": "2026-02-15T18:28:40.946210",
      "last_seen": "2026-02-15T18:28:40.946210",
      "weight": 1
    },
    {
      "source": "event:past_blog_failure",
      "target": "insight:cognitive_load_risk",
      "type": "CAUSAL",
      "label": "過去の重荷感がリスクへの警戒を生んでいる",
      "first_seen": "2026-02-15T18:28:40.946211",
      "last_seen": "2026-02-15T18:28:40.946211",
      "weight": 1
    },
    {
      "source": "project:self_analysis_flow",
      "target": "insight:cognitive_load_risk",
      "type": "SOLVES",
      "label": "責務をはっきりさせることで負荷を軽減する",
      "first_seen": "2026-02-15T18:28:40.946212",
      "last_seen": "2026-02-15T18:28:40.946212",
      "weight": 1
    },
    {
      "source": "diary:2026-02-15",
      "target": "concept:pomera",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:40.946213",
      "last_seen": "2026-02-15T18:28:40.946213"
    },
    {
      "source": "diary:2026-02-15",
      "target": "project:self_analysis_flow",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:40.946215",
      "last_seen": "2026-02-15T18:28:40.946215"
    },
    {
      "source": "diary:2026-02-15",
      "target": "emotion:excitement",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:40.946215",
      "last_seen": "2026-02-15T18:28:40.946215"
    },
    {
      "source": "diary:2026-02-15",
      "target": "goal:sustainable_use",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:40.946216",
      "last_seen": "2026-02-15T18:28:40.946216"
    },
    {
      "source": "diary:2026-02-15",
      "target": "insight:cognitive_load_risk",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:40.946217",
      "last_seen": "2026-02-15T18:28:40.946217"
    },
    {
      "source": "diary:2026-02-15",
      "target": "event:past_blog_failure",
      "type": "MENTIONS",
      "label": "言及",
      "weight": 1,
      "first_seen": "2026-02-15T18:28:40.946218",
      "last_seen": "2026-02-15T18:28:40.946218"
    },
    {
      "source": "review:weekly:2026-02-15",
      "target": "diary:2026-02-14",
      "type": "ABOUT",
      "label": "対象期間として集計",
      "weight": 2,
      "first_seen": "2026-02-15T18:43:40.656154",
      "last_seen": "2026-02-15T19:02:29.908049"
    },
    {
      "source": "review:weekly:2026-02-15",
      "target": "diary:2026-02-15",
      "type": "ABOUT",
      "label": "対象期間として集計",
      "weight": 2,
      "first_seen": "2026-02-15T18:43:40.656156",
      "last_seen": "2026-02-15T19:02:29.908051"
    },
    {
      "source": "person:self",
      "target": "diary:2026-02-15",
      "type": "MENTIONS",
      "label": "記述する",
      "first_seen": "2026-02-15T19:44:17.435361",
      "last_seen": "2026-02-15T12:07:30.299734",
      "weight": 13
    },
    {
      "source": "person:self",
      "target": "event:pet_room_cleaning",
      "type": "PLANS",
      "label": "掃除を予定する",
      "first_seen": "2026-02-15T19:44:17.435363",
      "last_seen": "2026-02-15T12:07:30.299737",
      "weight": 13
    },
    {
      "source": "person:self",
      "target": "goal:clean_pet_room_habit",
      "type": "TARGETS",
      "label": "習慣化を目指す",
      "first_seen": "2026-02-15T19:44:17.435364",
      "last_seen": "2026-02-15T12:07:30.299739",
      "weight": 13
    },
    {
      "source": "person:self",
      "target": "insight:sticky_residue_problem",
      "type": "FEELING",
      "label": "悩んでいる",
      "first_seen": "2026-02-15T19:44:17.435365",
      "last_seen": "2026-02-15T12:07:30.299741",
      "weight": 13
    },
    {
      "source": "barrier:time_poverty",
      "target": "goal:clean_pet_room_habit",
      "type": "BARRIER",
      "label": "習慣化を阻害する",
      "first_seen": "2026-02-15T19:44:17.435366",
      "last_seen": "2026-02-15T12:07:30.299743",
      "weight": 13
    },
    {
      "source": "person:self",
      "target": "goal:weight_loss_75kg",
      "type": "TARGETS",
      "label": "減量を目指す",
      "first_seen": "2026-02-15T19:44:17.435367",
      "last_seen": "2026-02-16T00:39:23.912928",
      "weight": 16
    },
    {
      "source": "concept:cheat_day",
      "target": "insight:weight_plateau",
      "type": "SOLVES",
      "label": "停滞期打破のための対策",
      "first_seen": "2026-02-15T19:44:17.435367",
      "last_seen": "2026-02-15T12:07:30.299746",
      "weight": 13
    },
    {
      "source": "concept:dietary_restriction",
      "target": "goal:weight_loss_75kg",
      "type": "TARGETS",
      "label": "減量目標達成の手段",
      "first_seen": "2026-02-15T19:44:17.435368",
      "last_seen": "2026-02-15T12:07:30.299748",
      "weight": 13
    },
    {
      "source": "insight:weight_plateau",
      "target": "concept:cheat_day",
      "type": "TRIGGERED_BY",
      "label": "停滞をきっかけに導入",
      "first_seen": "2026-02-15T19:44:17.435369",
      "last_seen": "2026-02-15T12:07:30.299750",
      "weight": 13
    },
    {
      "source": "person:self",
      "target": "event:pet_room_cleaning",
      "type": "PARTICIPATES",
      "label": "掃除を行った",
      "first_seen": "2026-02-16T00:26:33.487813",
      "last_seen": "2026-02-16T00:26:33.487813",
      "weight": 1
    },
    {
      "source": "event:pet_room_cleaning",
      "target": "insight:sticky_residue",
      "type": "ABOUT",
      "label": "粘着部分の問題に直面",
      "first_seen": "2026-02-16T00:26:33.487815",
      "last_seen": "2026-02-16T00:26:33.487815",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "goal:cleaning_habit",
      "type": "TARGETS",
      "label": "習慣化を目指す",
      "first_seen": "2026-02-16T00:26:33.487816",
      "last_seen": "2026-02-16T00:26:33.487816",
      "weight": 1
    },
    {
      "source": "insight:weight_plateau",
      "target": "concept:cheat_day",
      "type": "CAUSAL",
      "label": "停滞打破のために導入",
      "first_seen": "2026-02-16T00:26:33.487819",
      "last_seen": "2026-02-16T00:26:33.487819",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "project:pomera_workflow",
      "type": "DISCOVERS",
      "label": "効率的なフローを考案した",
      "first_seen": "2026-02-16T00:26:33.487820",
      "last_seen": "2026-02-16T00:30:31.747251",
      "weight": 2
    },
    {
      "source": "person:self",
      "target": "emotion:workflow_fun",
      "type": "FEELING",
      "label": "楽しさを感じている",
      "first_seen": "2026-02-16T00:26:33.487821",
      "last_seen": "2026-02-16T00:39:23.912936",
      "weight": 3
    },
    {
      "source": "person:self",
      "target": "insight:youtube_restriction",
      "type": "FEELING",
      "label": "自制の必要性を感じる",
      "first_seen": "2026-02-16T00:26:33.487822",
      "last_seen": "2026-02-16T00:26:33.487822",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "project:monster_design",
      "type": "PARTICIPATES",
      "label": "毎日描いている",
      "first_seen": "2026-02-16T00:26:33.487824",
      "last_seen": "2026-02-16T00:26:33.487824",
      "weight": 1
    },
    {
      "source": "project:monster_design",
      "target": "goal:realistic_monster_design",
      "type": "TARGETS",
      "label": "リアリティを追求",
      "first_seen": "2026-02-16T00:26:33.487825",
      "last_seen": "2026-02-16T00:26:33.487825",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "event:shiroyama_park_walk",
      "type": "PARTICIPATES",
      "label": "家族で行った",
      "first_seen": "2026-02-16T00:26:33.487826",
      "last_seen": "2026-02-16T00:39:23.912941",
      "weight": 2
    },
    {
      "source": "event:shiroyama_park_walk",
      "target": "person:souma",
      "type": "ABOUT",
      "label": "蒼馬とシーソー",
      "first_seen": "2026-02-16T00:26:33.487827",
      "last_seen": "2026-02-16T00:26:33.487827",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "event:choking_incident",
      "type": "PARTICIPATES",
      "label": "クッキーを与え、救出した",
      "first_seen": "2026-02-16T00:26:33.487828",
      "last_seen": "2026-02-16T00:26:33.487828",
      "weight": 1
    },
    {
      "source": "event:choking_incident",
      "target": "insight:parental_regret",
      "type": "CAUSAL",
      "label": "不注意から自己嫌悪へ",
      "first_seen": "2026-02-16T00:26:33.487829",
      "last_seen": "2026-02-16T00:26:33.487829",
      "weight": 1
    },
    {
      "source": "project:pomera_workflow",
      "target": "concept:github_actions_workflow",
      "type": "EVOLVED_TO",
      "label": "技術構成が確定",
      "first_seen": "2026-02-16T00:26:33.487830",
      "last_seen": "2026-02-16T00:26:33.487830",
      "weight": 1
    },
    {
      "source": "project:pomera_workflow",
      "target": "goal:pomera_book",
      "type": "TARGETS",
      "label": "本の執筆を希望",
      "first_seen": "2026-02-16T00:26:33.487831",
      "last_seen": "2026-02-16T00:26:33.487831",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "person:mugi",
      "type": "MENTIONS",
      "label": "愛犬と一緒に散歩した",
      "first_seen": "2026-02-16T00:26:33.487832",
      "last_seen": "2026-02-16T00:30:31.747257",
      "weight": 2
    },
    {
      "source": "person:self",
      "target": "diary:2026-02-16",
      "relationship": "WROTE",
      "weight": 3,
      "first_seen": "2026-02-16T00:26:33.487833",
      "last_seen": "2026-02-16T00:39:23.912953",
      "label": null
    },
    {
      "source": "diary:2026-02-16",
      "target": "event:pet_room_cleaning",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:26:33.487834",
      "last_seen": "2026-02-16T00:26:33.487834"
    },
    {
      "source": "diary:2026-02-16",
      "target": "insight:sticky_residue",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:26:33.487835",
      "last_seen": "2026-02-16T00:26:33.487835"
    },
    {
      "source": "diary:2026-02-16",
      "target": "goal:cleaning_habit",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:26:33.487835",
      "last_seen": "2026-02-16T00:26:33.487835"
    },
    {
      "source": "diary:2026-02-16",
      "target": "goal:weight_loss_75kg",
      "relationship": "MENTIONS",
      "weight": 3,
      "first_seen": "2026-02-16T00:26:33.487836",
      "last_seen": "2026-02-16T00:39:23.912977",
      "label": null
    },
    {
      "source": "diary:2026-02-16",
      "target": "insight:weight_plateau",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:26:33.487837",
      "last_seen": "2026-02-16T00:26:33.487837"
    },
    {
      "source": "diary:2026-02-16",
      "target": "concept:cheat_day",
      "relationship": "MENTIONS",
      "weight": 3,
      "first_seen": "2026-02-16T00:26:33.487838",
      "last_seen": "2026-02-16T00:39:23.912981",
      "label": null
    },
    {
      "source": "diary:2026-02-16",
      "target": "project:pomera_workflow",
      "relationship": "MENTIONS",
      "weight": 2,
      "first_seen": "2026-02-16T00:26:33.487839",
      "last_seen": "2026-02-16T00:30:31.747271",
      "label": null
    },
    {
      "source": "diary:2026-02-16",
      "target": "emotion:workflow_fun",
      "relationship": "MENTIONS",
      "weight": 3,
      "first_seen": "2026-02-16T00:26:33.487840",
      "last_seen": "2026-02-16T00:39:23.912985",
      "label": null
    },
    {
      "source": "diary:2026-02-16",
      "target": "insight:youtube_restriction",
      "relationship": "MENTIONS",
      "weight": 2,
      "first_seen": "2026-02-16T00:26:33.487841",
      "last_seen": "2026-02-16T00:39:23.912988",
      "label": null
    },
    {
      "source": "diary:2026-02-16",
      "target": "project:monster_design",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:26:33.487842",
      "last_seen": "2026-02-16T00:26:33.487842"
    },
    {
      "source": "diary:2026-02-16",
      "target": "goal:realistic_monster_design",
      "relationship": "MENTIONS",
      "weight": 3,
      "first_seen": "2026-02-16T00:26:33.487843",
      "last_seen": "2026-02-16T00:39:23.912991",
      "label": null
    },
    {
      "source": "diary:2026-02-16",
      "target": "person:mugi",
      "relationship": "MENTIONS",
      "weight": 3,
      "first_seen": "2026-02-16T00:26:33.487845",
      "last_seen": "2026-02-16T00:39:23.912993",
      "label": null
    },
    {
      "source": "diary:2026-02-16",
      "target": "person:souma",
      "relationship": "MENTIONS",
      "weight": 3,
      "first_seen": "2026-02-16T00:26:33.487846",
      "last_seen": "2026-02-16T00:39:23.912996",
      "label": null
    },
    {
      "source": "diary:2026-02-16",
      "target": "person:sayaka",
      "relationship": "MENTIONS",
      "weight": 3,
      "first_seen": "2026-02-16T00:26:33.487847",
      "last_seen": "2026-02-16T00:39:23.912998",
      "label": null
    },
    {
      "source": "diary:2026-02-16",
      "target": "event:shiroyama_park_walk",
      "relationship": "MENTIONS",
      "weight": 2,
      "first_seen": "2026-02-16T00:26:33.487848",
      "last_seen": "2026-02-16T00:39:23.913000",
      "label": null
    },
    {
      "source": "diary:2026-02-16",
      "target": "event:choking_incident",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:26:33.487849",
      "last_seen": "2026-02-16T00:26:33.487849"
    },
    {
      "source": "diary:2026-02-16",
      "target": "insight:parental_regret",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:26:33.487850",
      "last_seen": "2026-02-16T00:26:33.487850"
    },
    {
      "source": "diary:2026-02-16",
      "target": "concept:github_actions_workflow",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:26:33.487852",
      "last_seen": "2026-02-16T00:26:33.487852"
    },
    {
      "source": "diary:2026-02-16",
      "target": "goal:pomera_book",
      "relationship": "MENTIONS",
      "weight": 2,
      "first_seen": "2026-02-16T00:26:33.487852",
      "last_seen": "2026-02-16T00:39:23.913007",
      "label": null
    },
    {
      "source": "person:self",
      "target": "goal:clean_pet_room",
      "type": "TARGETS",
      "label": "掃除を目標としている",
      "first_seen": "2026-02-16T00:30:31.747246",
      "last_seen": "2026-02-16T00:30:31.747246",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "goal:realistic_monster_design",
      "type": "TARGETS",
      "label": "理想の絵を目指す",
      "first_seen": "2026-02-16T00:30:31.747250",
      "last_seen": "2026-02-16T00:39:23.912939",
      "weight": 2
    },
    {
      "source": "person:self",
      "target": "event:choking_accident",
      "type": "PARTICIPATES",
      "label": "仕事中に食事を与えていた",
      "first_seen": "2026-02-16T00:30:31.747253",
      "last_seen": "2026-02-16T00:30:31.747253",
      "weight": 1
    },
    {
      "source": "event:choking_accident",
      "target": "person:souma",
      "type": "ABOUT",
      "label": "息子が危険な目にあった",
      "first_seen": "2026-02-16T00:30:31.747254",
      "last_seen": "2026-02-16T00:30:31.747254",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "place:shiroyama_park",
      "type": "AT",
      "label": "家族で訪れた",
      "first_seen": "2026-02-16T00:30:31.747255",
      "last_seen": "2026-02-16T00:30:31.747255",
      "weight": 1
    },
    {
      "source": "project:pomera_workflow",
      "target": "insight:gh_actions_limitation",
      "type": "BARRIER",
      "label": "実行時間の制御が課題",
      "first_seen": "2026-02-16T00:30:31.747258",
      "last_seen": "2026-02-16T00:30:31.747258",
      "weight": 1
    },
    {
      "source": "project:pomera_workflow",
      "target": "goal:publish_book",
      "type": "EVOLVED_TO",
      "label": "成果を本にしたいという願望へ",
      "first_seen": "2026-02-16T00:30:31.747260",
      "last_seen": "2026-02-16T00:30:31.747260",
      "weight": 1
    },
    {
      "source": "goal:weight_loss_75kg",
      "target": "concept:cheat_day",
      "type": "PLANS",
      "label": "停滞期打破のために導入",
      "first_seen": "2026-02-16T00:30:31.747261",
      "last_seen": "2026-02-16T00:30:31.747261",
      "weight": 1
    },
    {
      "source": "event:choking_accident",
      "target": "person:sayaka",
      "type": "SOLVES",
      "label": "妻が口からクッキーを取り出した",
      "first_seen": "2026-02-16T00:30:31.747262",
      "last_seen": "2026-02-16T00:30:31.747262",
      "weight": 1
    },
    {
      "source": "diary:2026-02-16",
      "target": "place:shiroyama_park",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:30:31.747267",
      "last_seen": "2026-02-16T00:30:31.747267"
    },
    {
      "source": "diary:2026-02-16",
      "target": "goal:clean_pet_room",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:30:31.747268",
      "last_seen": "2026-02-16T00:30:31.747268"
    },
    {
      "source": "diary:2026-02-16",
      "target": "event:choking_accident",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:30:31.747273",
      "last_seen": "2026-02-16T00:30:31.747273"
    },
    {
      "source": "diary:2026-02-16",
      "target": "insight:gh_actions_limitation",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:30:31.747274",
      "last_seen": "2026-02-16T00:30:31.747274"
    },
    {
      "source": "diary:2026-02-16",
      "target": "goal:publish_book",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:30:31.747275",
      "last_seen": "2026-02-16T00:30:31.747275"
    },
    {
      "source": "person:self",
      "target": "event:cleaning_pet_room",
      "type": "PARTICIPATES",
      "label": "掃除を行った",
      "first_seen": "2026-02-16T00:39:23.912918",
      "last_seen": "2026-02-16T00:39:23.912918",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "goal:daily_cleaning",
      "type": "TARGETS",
      "label": "目標としている",
      "first_seen": "2026-02-16T00:39:23.912923",
      "last_seen": "2026-02-16T00:39:23.912923",
      "weight": 1
    },
    {
      "source": "insight:sticky_residue_problem",
      "target": "event:cleaning_pet_room",
      "type": "BARRIER",
      "label": "掃除の障害",
      "first_seen": "2026-02-16T00:39:23.912926",
      "last_seen": "2026-02-16T00:39:23.912926",
      "weight": 1
    },
    {
      "source": "concept:cheat_day",
      "target": "goal:weight_loss_75kg",
      "type": "SOLVES",
      "label": "停滞期対策",
      "first_seen": "2026-02-16T00:39:23.912931",
      "last_seen": "2026-02-16T00:39:23.912931",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "project:pomera_ai_workflow",
      "type": "DISCOVERS",
      "label": "ワークフローを構築中",
      "first_seen": "2026-02-16T00:39:23.912934",
      "last_seen": "2026-02-16T00:39:23.912934",
      "weight": 1
    },
    {
      "source": "event:souma_choking_incident",
      "target": "person:souma",
      "type": "ABOUT",
      "label": "息子に起きた事故",
      "first_seen": "2026-02-16T00:39:23.912943",
      "last_seen": "2026-02-16T00:39:23.912943",
      "weight": 1
    },
    {
      "source": "insight:parental_failure",
      "target": "event:souma_choking_incident",
      "type": "TRIGGERED_BY",
      "label": "事故により自己嫌悪に陥る",
      "first_seen": "2026-02-16T00:39:23.912946",
      "last_seen": "2026-02-16T00:39:23.912946",
      "weight": 1
    },
    {
      "source": "person:self",
      "target": "goal:pomera_book",
      "type": "TARGETS",
      "label": "出版を希望している",
      "first_seen": "2026-02-16T00:39:23.912948",
      "last_seen": "2026-02-16T00:39:23.912948",
      "weight": 1
    },
    {
      "source": "insight:github_actions_scheduling",
      "target": "project:pomera_ai_workflow",
      "type": "BARRIER",
      "label": "運用上の懸念",
      "first_seen": "2026-02-16T00:39:23.912951",
      "last_seen": "2026-02-16T00:39:23.912951",
      "weight": 1
    },
    {
      "source": "diary:2026-02-16",
      "target": "event:cleaning_pet_room",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:39:23.912955",
      "last_seen": "2026-02-16T00:39:23.912955"
    },
    {
      "source": "diary:2026-02-16",
      "target": "goal:daily_cleaning",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:39:23.912971",
      "last_seen": "2026-02-16T00:39:23.912971"
    },
    {
      "source": "diary:2026-02-16",
      "target": "insight:sticky_residue_problem",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:39:23.912975",
      "last_seen": "2026-02-16T00:39:23.912975"
    },
    {
      "source": "diary:2026-02-16",
      "target": "project:pomera_ai_workflow",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:39:23.912983",
      "last_seen": "2026-02-16T00:39:23.912983"
    },
    {
      "source": "diary:2026-02-16",
      "target": "event:souma_choking_incident",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:39:23.913002",
      "last_seen": "2026-02-16T00:39:23.913002"
    },
    {
      "source": "diary:2026-02-16",
      "target": "insight:parental_failure",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:39:23.913004",
      "last_seen": "2026-02-16T00:39:23.913004"
    },
    {
      "source": "diary:2026-02-16",
      "target": "insight:github_actions_scheduling",
      "relationship": "MENTIONS",
      "weight": 1,
      "first_seen": "2026-02-16T00:39:23.913009",
      "last_seen": "2026-02-16T00:39:23.913009"
    }
  ],
  "metadata": {
    "created_at": "2026-02-15T18:27:41.189275",
    "last_updated": "2026-02-16T00:39:23.913014",
    "node_count": 57,
    "edge_count": 120
  }
};
    // GRAPH_DATA_END

    // STATE_INIT
    const state = {
      selectedNodeId: null,
      mode: 'default', // default, sentiment, community
      highlightDistortion: false
    };

    const colorMap = {
      "self": "#f43f5e",
      "person": "#3b82f6",
      "event": "#f59e0b",
      "place": "#10b981",
      "project": "#8b5cf6",
      "emotion": "#ec4899",
      "insight": "#06b6d4",
      "concept": "#64748b",
      "goal": "#ef4444",
      "diary": "#94a3b8",
      "review": "#fbbf24"
    };

    const communityColors = d3.schemeTableau10;

    // ── Pre-process Data (Filter Diary/Review Nodes) ──
    const journalTypes = new Set(['diary', 'review']);

    // Separate nodes
    const graphNodes = GRAPH_DATA.nodes.filter(n => !journalTypes.has(n.type));
    const journalNodes = GRAPH_DATA.nodes.filter(n => journalTypes.has(n.type));

    // Create specific edges for simulation (only those between graph nodes)
    const graphNodeIds = new Set(graphNodes.map(n => n.id));
    // D3 links need references to nodes or specific IDs. 
    // Since data.edges might use 'source'/'target' as strings initially, we filter them.
    const graphEdges = GRAPH_DATA.edges.filter(e => {
      const s = typeof e.source === 'object' ? e.source.id : e.source;
      const t = typeof e.target === 'object' ? e.target.id : e.target;
      return graphNodeIds.has(s) && graphNodeIds.has(t);
    }).map(e => ({ ...e })); // Clone to avoid mutating original if needed

    // Sort Journal Nodes by Date Descending
    journalNodes.sort((a, b) => {
      const dateA = a.date || a.first_seen || "";
      const dateB = b.date || b.first_seen || "";
      return dateB.localeCompare(dateA);
    });

    // Populate Sidebar Journal List
    const journalList = document.getElementById('journal-list');
    if (journalList) {
      journalList.innerHTML = '';
      journalNodes.forEach(d => {
        const item = document.createElement('div');
        item.style.padding = '10px';
        item.style.borderBottom = '1px solid #334155';
        item.style.cursor = 'pointer';
        item.style.transition = 'background 0.2s';

        item.onmouseover = () => item.style.background = '#334155';
        item.onmouseout = () => item.style.background = 'transparent';

        const typeColor = d.type === 'review' ? '#fbbf24' : '#94a3b8';
        const label = d.label || d.id;
        const dateStr = d.date || label;

        item.innerHTML = `
                <div style="display:flex; align-items:center; gap:8px;">
                    <div style="width:8px; height:8px; border-radius:50%; background:${typeColor}"></div>
                    <div style="font-weight:600; font-size:12px; color:#f1f5f9;">${d.type === 'review' ? '週次レビュー' : '日記'}</div>
                </div>
                <div style="font-size:11px; color:#cbd5e1; margin-top:4px; margin-left:16px;">${dateStr}</div>
            `;

        item.onclick = (e) => {
          e.stopPropagation();
          updateDetailPanel(d);
          highlightConnectedNodes(d.id);
        };
        journalList.appendChild(item);
      });
    }

    // ── Visualization Setup ──
    const container = document.getElementById('graph-container');
    const width = container.clientWidth;
    const height = container.clientHeight;
    const tooltip = document.getElementById('tooltip');

    const svg = d3.select('#graph-container').append('svg')
      .attr('width', '100%').attr('height', '100%')
      .attr('viewBox', [0, 0, width, height]);

    const g = svg.append('g');

    // Zoom
    const zoom = d3.zoom().scaleExtent([0.1, 8]).on('zoom', (e) => g.attr('transform', e.transform));
    svg.call(zoom);

    // Markers
    const defs = svg.append('defs');
    ['arrow-default', 'arrow-causal'].forEach(id => {
      defs.append('marker')
        .attr('id', id)
        .attr('viewBox', '0 -5 10 10')
        .attr('refX', 18).attr('refY', 0)
        .attr('markerWidth', 6).attr('markerHeight', 6)
        .attr('orient', 'auto')
        .append('path').attr('d', 'M0,-5L10,0L0,5')
        .attr('fill', id === 'arrow-causal' ? '#f472b6' : '#64748b');
    });

    // Simulation
    let simulation = d3.forceSimulation(graphNodes)
      .force('link', d3.forceLink(graphEdges).id(d => d.id).distance(100))
      .force('charge', d3.forceManyBody().strength(-300))
      .force('center', d3.forceCenter(width / 2, height / 2))
      .force('collide', d3.forceCollide().radius(d => getRadius(d) + 10));

    // Elements
    const linkGroup = g.append('g').attr('class', 'links');
    const nodeGroup = g.append('g').attr('class', 'nodes');

    let link = linkGroup.selectAll('line').data(graphEdges).join('line')
      .attr('stroke-width', d => d.type === 'CAUSAL' ? 2 : 1)
      .attr('stroke', '#475569')
      .attr('marker-end', d => d.type === 'CAUSAL' ? 'url(#arrow-causal)' : 'url(#arrow-default)');

    let node = nodeGroup.selectAll('g').data(graphNodes).join('g')
      .call(d3.drag().on('start', dragstarted).on('drag', dragged).on('end', dragended));

    const circles = node.append('circle')
      .attr('r', d => getRadius(d))
      .attr('fill', d => getColor(d))
      .attr('stroke', '#fff')
      .attr('stroke-width', 0);

    const labels = node.append('text')
      .attr('dx', d => getRadius(d) + 5).attr('dy', 4)
      .text(d => d.label)
      .attr('fill', '#e2e8f0')
      .style('font-size', '11px')
      .style('pointer-events', 'none')
      .style('text-shadow', '0 1px 4px rgba(0,0,0,0.8)');

    // Events
    svg.on('click', (e) => {
      if (e.target.tagName === 'svg') {
        state.selectedNodeId = null;
        resetHighlight();
        document.getElementById('detail-panel').innerHTML = '<div class="detail-empty">ノードをクリックして詳細を表示</div>';
      }
    });

    node.on('click', (e, d) => {
      e.stopPropagation();
      state.selectedNodeId = d.id;
      updateDetailPanel(d);
      highlightNode(d);
    });

    node.on('mouseover', (e, d) => {
      tooltip.style.opacity = 1;
      tooltip.innerHTML = `
        <div style="font-weight:700; margin-bottom:4px; color:${getColor(d)}">${d.label}</div>
        <div style="font-size:10px; color:#94a3b8">${d.type}</div>
        ${d.sentiment ? `<div style="margin-top:4px;">Sentiment: ${d.sentiment}</div>` : ''}
      `;
      tooltip.style.left = (e.pageX + 10) + 'px';
      tooltip.style.top = (e.pageY - 10) + 'px';
    }).on('mouseout', () => tooltip.style.opacity = 0);

    simulation.on('tick', () => {
      link
        .attr('x1', d => d.source.x).attr('y1', d => d.source.y)
        .attr('x2', d => d.target.x).attr('y2', d => d.target.y);
      node.attr('transform', d => `translate(${d.x},${d.y})`);
    });

    // ── Functions ──

    function getRadius(d) {
      return d.id === 'person:self' ? 18 : (d.weight ? 5 + d.weight * 1.5 : 8);
    }

    function getColor(d) {
      if (state.mode === 'sentiment') {
        if (!d.sentiment) return '#475569';
        return d.sentiment > 0 ? '#34d399' : '#f87171';
      }
      if (state.mode === 'community') {
        return communityColors[d.community % 10] || '#94a3b8';
      }
      return colorMap[d.type] || '#94a3b8';
    }

    function setMode(mode) {
      state.mode = mode;
      document.querySelectorAll('.mode-btn').forEach(el => el.classList.remove('active'));
      // Safety check for button existence
      const btn = document.querySelector(`.mode-btn[onclick="setMode('${mode}')"]`);
      if (btn) btn.classList.add('active');

      circles.transition().duration(500).attr('fill', d => getColor(d));

      const info = document.getElementById('info-box');
      if (info) {
        if (mode === 'sentiment') info.style.display = 'block';
        else if (mode === 'community') info.style.display = 'block';
        else info.style.display = 'none';
      }
    }

    function toggleDistortion() {
      state.highlightDistortion = !state.highlightDistortion;
      circles.transition().duration(300)
        .attr('stroke', d => {
          if (state.highlightDistortion && d.tags && d.tags.some(t => t.includes('Cognitive Distortion'))) {
            return '#f43f5e';
          }
          return '#fff';
        })
        .attr('stroke-width', d => {
          if (state.highlightDistortion && d.tags && d.tags.some(t => t.includes('Cognitive Distortion'))) {
            return 4;
          }
          return 0;
        });
    }

    // Highlighting Logic

    // Highlight a visible node in the graph
    function highlightNode(d) {
      const connectedNodeIds = new Set();
      connectedNodeIds.add(d.id);

      GRAPH_DATA.edges.forEach(l => {
        // Check original edges for connections
        const s = (typeof l.source === 'object') ? l.source.id : l.source;
        const t = (typeof l.target === 'object') ? l.target.id : l.target;

        if (s === d.id) connectedNodeIds.add(t);
        if (t === d.id) connectedNodeIds.add(s);
      });

      circles.transition().attr('opacity', n => connectedNodeIds.has(n.id) ? 1 : 0.1);
      link.transition().attr('opacity', l => (l.source.id === d.id || l.target.id === d.id) ? 1 : 0.05);
      labels.transition().attr('opacity', n => connectedNodeIds.has(n.id) ? 1 : 0.1);
    }

    // Highlight nodes connected to a hidden journal node
    function highlightConnectedNodes(journalId) {
      const connectedNodeIds = new Set();
      // Look up connections in ALL edges
      GRAPH_DATA.edges.forEach(l => {
        const s = (typeof l.source === 'object') ? l.source.id : l.source;
        const t = (typeof l.target === 'object') ? l.target.id : l.target;

        if (s === journalId) connectedNodeIds.add(t);
        if (t === journalId) connectedNodeIds.add(s);
      });

      // Update visual elements
      circles.transition().attr('opacity', n => connectedNodeIds.has(n.id) ? 1 : 0.1);
      link.transition().attr('opacity', 0.05); // Hide all links as the journal node isn't there
      labels.transition().attr('opacity', n => connectedNodeIds.has(n.id) ? 1 : 0.1);
    }

    function resetHighlight() {
      circles.transition().attr('opacity', 1);
      link.transition().attr('opacity', 1);
      labels.transition().attr('opacity', 1);
    }

    function resetZoom() {
      svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity);
    }

    // UI Updates
    function updateDetailPanel(d) {
      const panel = document.getElementById('detail-panel');
      let html = `
        <div class="detail-header" style="border-left: 4px solid ${getColor(d)}; padding-left: 10px;">
          <div style="font-size:10px; font-weight:700; color:#94a3b8; text-transform:uppercase;">${d.type}</div>
          <div class="detail-label" style="font-size:18px; font-weight:700; color:#fff;">${d.label}</div>
        </div>
        <div class="detail-content">
          <div style="margin-bottom:12px; font-size:14px; color:#cbd5e1; line-height:1.6;">${d.detail || '詳細情報なし'}</div>
        </div>
      `;

      if (d.tags && d.tags.length > 0) {
        html += `
        <div class="tags-container" style="display:flex; gap:6px; flex-wrap:wrap; margin-bottom:16px;">
            ${d.tags.map(t => `<span class="tag" style="background:#334155; color:#94a3b8; padding:3px 8px; border-radius:4px; font-size:10px; border:1px solid #475569;">${t}</span>`).join('')}
        </div>`;
      }

      // Render Analysis Report Button if available
      if (d.analysis_content) {
        html += `
          <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #475569;">
            <button onclick="openAnalysisModal('${d.id}')" style="width:100%; padding:12px; background:linear-gradient(135deg, #ec4899, #8b5cf6); color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px; transition: transform 0.1s;">
               <span style="font-size:16px">📜</span> AI分析レポートを読む
            </button>
          </div>
        `;
      }

      panel.innerHTML = html;
    }

    // ── Modal Functions ──
    function openAnalysisModal(nodeId) {
      const node = GRAPH_DATA.nodes.find(n => n.id === nodeId);
      if (!node || !node.analysis_content) return;

      const modal = document.getElementById('analysis-modal');
      const body = document.getElementById('modal-body');

      // Use marked to parse markdown
      body.innerHTML = marked.parse(node.analysis_content);

      modal.style.display = 'flex';

      // Close on Escape key
      document.onkeydown = function (evt) {
        if (evt.key === "Escape") closeModal();
      };
    }

    function closeModal(e) {
      document.getElementById('analysis-modal').style.display = 'none';
      document.onkeydown = null;
    }

    // Drag Functions
    function dragstarted(e, d) {
      if (!e.active) simulation.alphaTarget(0.3).restart();
      d.fx = d.x; d.fy = d.y;
    }
    function dragged(e, d) {
      d.fx = e.x; d.fy = e.y;
    }
    function dragended(e, d) {
      if (!e.active) simulation.alphaTarget(0);
      d.fx = null; d.fy = null;
    }

    // Keyboard Reset
    window.resetZoom = resetZoom;

    // ── Future Goals Rendering (Right Sidebar) ──
    function renderFutureGoals() {
      const container = document.getElementById('goal-list');
      if (!container) return;
      container.innerHTML = '';

      // Filter for Goals and Events
      const goals = GRAPH_DATA.nodes.filter(n =>
        (n.type === 'goal' && n.status === 'Active') ||
        (n.type === 'event' && n.status === 'Scheduled')
      );

      // Sort: Events by Date (Asc), Goals by Weight (Desc)
      goals.sort((a, b) => {
        if (a.type === 'event' && b.type === 'event') {
          return (a.date || '9999').localeCompare(b.date || '9999');
        }
        if (a.type === 'event') return -1;
        if (b.type === 'event') return 1;
        return b.weight - a.weight;
      });

      if (goals.length === 0) {
        container.innerHTML = '<div style="color:#64748b; font-size:12px; text-align:center; padding:20px;">No active goals or scheduled events.</div>';
        return;
      }

      goals.forEach(node => {
        const div = document.createElement('div');
        div.className = 'goal-item';
        // Check if focusNode is available
        div.onclick = () => { if (typeof focusNode === 'function') focusNode(node); };
        div.style.cursor = 'pointer';

        let dateDisplay = '';
        if (node.date) dateDisplay = `<div class="goal-date">📅 ${node.date}</div>`;

        let typeLabel = node.type === 'event' ? 'SCHEDULED' : 'ACTIVE GOAL';
        let typeClass = node.type;

        div.innerHTML = `
                                  <div class="goal-type ${typeClass}">${typeLabel}</div>
                                  ${dateDisplay}
                                  <div class="goal-label">${node.label}</div>
                                `;
        container.appendChild(div);
      });
    }

    // Initial Trigger
    renderFutureGoals();
    setMode('default');
  </script>
</body>

</html>